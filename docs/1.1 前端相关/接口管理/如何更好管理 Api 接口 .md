[å¦‚ä½•æ›´å¥½ç®¡ç† Api æ¥å£](https://juejin.cn/post/6844904154574356493)

èŠæ¥å£ç®¡ç†ï¼Œç¦»ä¸å¼€è¯·æ±‚åº“ï¼ŒvueæŠ€æœ¯æ ˆä¸­è¯·æ±‚åº“è°ˆåŠæœ€å¤šçš„ï¼Œéaxiosè«å±ï¼Œå…ˆè®©æˆ‘ä»¬é‡æ–°æ¢³ç†ä¸‹axios

### 1.axios

> â
>
> axios æ˜¯ä¸€ä¸ªåŸºäºPromise ç”¨äºæµè§ˆå™¨å’Œ nodejs çš„ HTTP å®¢æˆ·ç«¯ï¼Œæ ‘é…±æŒ‘äº†ä¸‰ä¸ªè§‰å¾—ç‰¹åˆ«å¥½ç”¨çš„ç‰¹å¾å” å” ğŸ‘‡
>
> â

#### 1.1æ”¯æŒå–æ¶ˆè¯·æ±‚ (cancelToken)

> â
>
> åº”ç”¨åœºæ™¯ï¼šå½“ç”¨æˆ·é‡æ–°åˆ·æ–°æ•°æ®è¯·æ±‚çš„æ—¶å€™ï¼Œå¦‚æœä½ ä¹‹å‰å‘èµ·çš„è¯·æ±‚åˆ—è¡¨è¿˜æ²¡æœ‰å“åº”ï¼Œè¿™æ—¶å€™å¦‚æœä½ é‡æ–°å‘èµ·è¯·æ±‚ï¼Œä¼šå‡ºç°äºŒæ¬¡è¯·æ±‚çš„æƒ…å†µï¼Œå¯ä»¥é€šè¿‡cancelTokenå¯ä»¥å–æ¶ˆä¸Šä¸€æ¬¡è¯·æ±‚ [ä½¿ç”¨æ–‡æ¡£](http://www.axios-js.com/zh-cn/docs/index.html#å–æ¶ˆ)
>
> â

![img](https://user-gold-cdn.xitu.io/2020/5/12/17206d838153fb1f?imageView2/0/w/1280/h/960/ignore-error/1) é‚£ä¹ˆcancelTokenæ˜¯å¦‚ä½•å®ç°çš„ï¼Œå¯ä»¥é˜…è¯»ä¸‹æºç ï¼Œæºç é“¾æ¥ [ç‚¹æˆ‘](https://github.com/axios/axios/blob/405fe690f93264d591b7a64d006314e2222c8727/lib/cancel/CancelToken.js) æ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥çœ‹è¿™ç¯‡ [axios ä¹‹cancelTokenåŸç†](https://www.cnblogs.com/ysk123/p/11544211.html)

#### 2.æ”¯æŒPromise APIï¼ˆaxios.allã€axios.spreadç­‰ï¼‰

> â
>
> åº”ç”¨åœºæ™¯ï¼šå½“æˆ‘æƒ³åŒæ—¶å‘èµ·å¤šä¸ªè¯·æ±‚æ—¶ï¼Œaxios.allç±»ä¼¼äº(promise.allï¼‰ç»™äºˆæˆ‘å¾ˆå¥½çš„ä½“éªŒæ–¹å¼ï¼Œè§£å†³äº†å¹¶å‘è¯·æ±‚çš„åº”ç”¨åœºæ™¯
>
> â

![img](https://user-gold-cdn.xitu.io/2020/5/12/17206d27c928c409?imageView2/0/w/1280/h/960/ignore-error/1)

#### 3.æ‹¦æˆªå™¨ï¼ˆæ‹¦æˆªè¯·æ±‚å’Œè¿”å›ï¼‰

> â
>
> åº”ç”¨åœºæ™¯ï¼šå½“ä¸€ä¸ªé¡¹ç›®ä¸­ï¼Œå¤šä¸ªæ¥å£éœ€è¦å‰ç«¯é€šè¿‡headerä¼ ç”¨æˆ·IDã€æ ¡éªŒtokenç­‰ç­‰æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ç»Ÿä¸€æ·»åŠ ï¼ŒåŒç†ï¼Œå½“æ¥å£å‡ºç°å¼‚å¸¸çš„çŠ¶æ€ç ï¼Œå¦‚401ï¼ˆç™»å½•è¿‡æœŸï¼‰éœ€è¦é‡å®šå‘åˆ°ç™»å½•é¡µé¢æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ç»Ÿä¸€æ·»åŠ å¤„ç†ï¼Œè¿™æ—¶å€™æ‹¦æˆªå™¨å°±èµ·åˆ°å¾ˆé‡è¦çš„ä½œç”¨
>
> â

![img](https://user-gold-cdn.xitu.io/2020/5/12/17206ded6e3138c2?imageView2/0/w/1280/h/960/ignore-error/1)

å¥½äº†åºŸè¯ä¸å¤šè¯´ï¼Œè¿›å…¥ä»Šå¤©çš„ä¸»é¢˜ï¼šå¦‚ä½•æ›´å¥½ç®¡ç† Api æ¥å£ã€‚

### 2.API ç®¡ç†

#### 2.1 æ–¹å¼ä¸€ï¼šæŒ‰æ¨¡å—å°è£…æ–¹æ³•

> â
>
> é€šè¿‡swaggeræ–‡æ¡£å®šä¹‰çš„åŠŸèƒ½æ¨¡å—ï¼Œæ¥å®šä¹‰ä¸åŒæ¨¡å—çš„serviceï¼Œå°è£…æ¥å£å¢åˆ æ”¹æŸ¥ç­‰æ–¹æ³•
>
> â

- æŒ‰swaggeræ¥å£æ–‡æ¡£çš„æ¨¡å—åˆ›å»ºç›®å½•

![img](https://user-gold-cdn.xitu.io/2020/5/12/17206ef96542948d?imageView2/0/w/1280/h/960/ignore-error/1)

- ç¼–å†™æ¨¡å—æ–¹æ³•ï¼ˆä¸¾ä¸ªç”¨æˆ·æ¨¡å—çš„ä¾‹å­ï¼‰

> â
>
> è¿™é‡Œç”¨åˆ°äº†ä¹‹å‰å°è£…çš„kdutilåº“[githubé“¾æ¥](https://github.com/littleTreeme/kdutil)ä¸­çš„httpæ–¹æ³•ï¼Œæœ¬è´¨ä¸Šæ˜¯å¯¹axiosè¿›è¡ŒäºŒæ¬¡å°è£…ï¼Œé€šè¿‡ä¸åŒçš„apiæ“ä½œæ¥å°è£…ä¸åŒçš„è¯·æ±‚æ–¹æ³•
>
> â

![img](https://user-gold-cdn.xitu.io/2020/5/12/17206f498f1f8d3f?imageView2/0/w/1280/h/960/ignore-error/1)

- å¯¼å‡ºæ‰€æœ‰ç¼–å†™å¥½çš„æ¨¡å—

å½“æˆ‘ä»¬å°†ä¸åŒæ¨¡å—å¯¹åº”çš„Swaggeræ¥å£æ–‡æ¡£éƒ½å°è£…å®Œæˆä¹‹åï¼Œå¯ä»¥å°†å„æ¨¡å—å¯¼å‡ºå®‰è£…ä¸ºæ’ä»¶çš„å½¢å¼æ¥æŒ‚è½½ï¼Œæ¨¡å—å¯¼å‡ºä½¿ç”¨çš„æ˜¯webpackæ‰“åŒ…çš„require.contextçš„æ–¹æ³•ï¼Œå¼•å…¥æŒ‡å®šçš„è·¯å¾„ä¸‹åŒ¹é…åˆ°çš„æ¨¡å—å¼•ç”¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºğŸ‘‡

![img](https://user-gold-cdn.xitu.io/2020/5/12/17206f9e847a0d50?imageView2/0/w/1280/h/960/ignore-error/1)

ä¸ºäº†è®©è¿™äº›æ¨¡å—åœ¨Vueä¸­æ›´å¥½åœ°ç›´æ¥ä½¿ç”¨ï¼Œæˆ‘ä»¬å°†å¯¼å‡ºçš„æ¨¡å—é€šè¿‡â€œæŒ‚åœ¨â€Vue.prototypeçš„å½¢å¼æ³¨å…¥åˆ°Vueç»„ä»¶ä¸­,ä»¥æ­¤æ¥ä¸ºVueå¯¹è±¡æ·»åŠ äº†ä¸€ä¸ªåŸå‹å±æ€§ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå…¨å±€å˜é‡ã€‚

è¿™é‡Œæ¶‰åŠåˆ°vueæ’ä»¶çš„ä½¿ç”¨ï¼Œvue æ’ä»¶ä¸€èˆ¬æ¥ç”¨è¿›è¡Œå¦‚ä¸‹å‡ ç§æ“ä½œ

- æ·»åŠ å…¨å±€æ–¹æ³•æˆ–è€… propertyã€‚å¦‚ï¼švue-custom-element
- æ·»åŠ å…¨å±€èµ„æºï¼šæŒ‡ä»¤/è¿‡æ»¤å™¨/è¿‡æ¸¡ç­‰ã€‚å¦‚ vue-touch
- é€šè¿‡å…¨å±€æ··å…¥æ¥æ·»åŠ ä¸€äº›ç»„ä»¶é€‰é¡¹ã€‚å¦‚ vue-router
- æ·»åŠ  Vue å®ä¾‹æ–¹æ³•ï¼Œé€šè¿‡æŠŠå®ƒä»¬æ·»åŠ åˆ° Vue.prototype ä¸Šå®ç°ã€‚ï¼ˆä¸Šæ–‡ä½¿ç”¨çš„æ˜¯è¿™ç§æ“ä½œï¼‰
- ä¸€ä¸ªåº“ï¼Œæä¾›è‡ªå·±çš„ APIï¼ŒåŒæ—¶æä¾›ä¸Šé¢æåˆ°çš„ä¸€ä¸ªæˆ–å¤šä¸ªåŠŸèƒ½ã€‚å¦‚ vue-router

Vue.js çš„æ’ä»¶éœ€è¦æš´éœ²ä¸€ä¸ª install æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ Vue æ„é€ å™¨ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå¯é€‰çš„é€‰é¡¹å¯¹è±¡ï¼Œä¸Šå›¾è§£æå‡ºæ¥å¦‚ä¸‹æ‰€ç¤º

![img](https://user-gold-cdn.xitu.io/2020/5/12/1720797c70c3f5c0?imageView2/0/w/1280/h/960/ignore-error/1)

æœ€ååœ¨main.jsä¸­é€šè¿‡å…¨å±€æ–¹æ³• Vue.use() ä½¿ç”¨æ’ä»¶å¦‚å‘ä¸‹æ‰€ç¤ºğŸ‘‡

![img](https://user-gold-cdn.xitu.io/2020/5/12/17206fadf6dd2dbd?imageView2/0/w/1280/h/960/ignore-error/1)

- å¦‚ä½•åœ¨é¡¹ç›®ä¸­è°ƒç”¨

å› ä¸ºå·²ç»æŒ‚è½½åœ¨vueå¯¹è±¡çš„åŸå‹ä¸Šï¼Œå¯ä»¥ä½¿ç”¨`this.$api`å»è°ƒæ¨¡å—

![img](https://user-gold-cdn.xitu.io/2020/5/12/172070112d31abae?imageView2/0/w/1280/h/960/ignore-error/1)

> â
>
> èŠåˆ°ä½ å¯èƒ½ç–‘æƒ‘å°±æ˜¯ï¼Œä½ è¿™æ¥å£è·¯å¾„ä¸å¯¹å•Šï¼Œæ€ä¹ˆæ˜¯ç›¸å¯¹è·¯å¾„å‘¢ï¼Ÿå…¶å®æ˜¯åœ¨axios.createçš„æ—¶å€™å°±æŠŠè·¯å¾„å†™è¿›å»äº†,å¦‚ä¸‹æ‰€ç¤ºğŸ‘‡
>
> â

![img](https://user-gold-cdn.xitu.io/2020/5/12/172079c67fa018c9?imageView2/0/w/1280/h/960/ignore-error/1)

è€Œè¿™ä¸ª`process.env.VUE_APP_URL`åˆæ˜¯ä»€ä¹ˆç©æ„ï¼Ÿ

> â
>
> æ˜¯é€šè¿‡ä¸åŒç¯å¢ƒï¼ˆå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ï¼‰å®šä¹‰çš„ä¸åŒç¯å¢ƒçš„é…ç½®æ–‡ä»¶ï¼ˆè¯·æ±‚apiã€å…¶ä»–é…ç½®ç­‰ç­‰ï¼‰å…·ä½“å¯ä»¥çœ‹ä¸‹æ ‘é…±çš„ [ã€ŠåŸºäº Vue-cli 3xçš„é¡¹ç›®éƒ¨ç½²ã€‹](https://juejin.im/post/6844904031924682760)çš„ä»‹ç»
>
> â

![img](https://user-gold-cdn.xitu.io/2020/5/12/17207a2313409c15?imageView2/0/w/1280/h/960/ignore-error/1)

æ€»ç»“ï¼šè¿™ç§æ–¹å¼ä¼˜åŠ¿åœ¨äºå¯ä»¥å¾ˆç›´æ¥çš„è¾¨åˆ«æ¥å£å¢åˆ æ”¹æŸ¥å¯¹åº”çš„æ–¹æ³•ï¼Œä¸”æŒ‚è½½åœ¨vueå¯¹è±¡åŸå‹ä¸­æ–¹ä¾¿è°ƒç”¨ï¼Œä¸€ç›®äº†ç„¶ï¼ŒåŠ£åŠ¿åœ¨äºé‡å¤ä»£ç è¿˜æ˜¯åå¤šï¼Œæ¥ä¸‹æ¥è®©æˆ‘ä»¬ä¸€èµ·çœ‹çœ‹ä¸‹é¢çš„è¿™ç§æ–¹å¼

#### 2.2 æ–¹å¼äºŒ. æŒ‰apiæ–‡æ¡£ç¼–å†™API

> â
>
> ä¸Šä¸€èŠ‚è®²å®Œçš„æ–¹å¼ä¸€ï¼Œå¯¼å‡ºçš„æœ¬è´¨ä¸Šæ˜¯æ–¹æ³•ï¼Œé‚£æ–¹å¼äºŒåˆæ˜¯æ€ä¹ˆæ ·çš„ä¸€ç§å½¢å¼ï¼Œç­”æ¡ˆæ˜¯å¯¼å‡ºé…ç½®æ–‡ä»¶
>
> â

- å…ˆâ€œä¸Šæ‰è‰ºâ€ï¼Œå…ˆç»™ç›®å½•ç»“æ„

> â
>
> é€šè¿‡åœ¨é…ç½®æ–‡ä»¶å¤¹å®šä¹‰apiï¼ŒåŒç†ä»¥ä¸åŒæ¨¡å—æ‹†åˆ†ï¼Œä¸‹é¢ä¸¾useræ¨¡å—è¿™ä¸ªä¾‹å­è¯´æ˜
>
> â

![img](https://user-gold-cdn.xitu.io/2020/5/12/17207affd80c6478?imageView2/0/w/1280/h/960/ignore-error/1)

- æŒ‰æ¨¡å—ç¼–å†™api

![img](https://user-gold-cdn.xitu.io/2020/5/12/17207c1a957012a0?imageView2/0/w/1280/h/960/ignore-error/1)

- å¯¼å‡ºæ‰€æœ‰ç¼–å†™å¥½çš„apié…ç½®

> â
>
> è·Ÿä¸Šä¸€èŠ‚å¯¼å‡ºæ¨¡å—ä¸€æ ·ï¼Œéƒ½æ˜¯ä½¿ç”¨require.contextï¼Œç„¶åå†ç»“åˆObject.defindpropertyæ–¹æ³•æ¥ä¿®æ”¹å¯¹è±¡çš„å±æ€§ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„apiè·¯å¾„
>
> â

![img](https://user-gold-cdn.xitu.io/2020/5/12/17207b318c737e08?imageView2/0/w/1280/h/960/ignore-error/1)

- æ‹“å±•ï¼šObject.defineProperty

å…³äºObject.definePropertyï¼Œè¿™é‡Œä¹Ÿç®€å•è®²ä¸€ä¸‹

> â
>
> MDNä»‹ç»ï¼šç›´æ¥åœ¨ä¸€ä¸ªå¯¹è±¡ä¸Šå®šä¹‰ä¸€ä¸ªæ–°å±æ€§ï¼Œæˆ–è€…ä¿®æ”¹ä¸€ä¸ªå¯¹è±¡çš„ç°æœ‰å±æ€§ï¼Œå¹¶è¿”å›æ­¤å¯¹è±¡ã€‚
>
> â

Object.definePropertyå¯¹åº”çš„ä¸‰ä¸ªæ•°å€¼

- obj è¦åœ¨å…¶ä¸Šå®šä¹‰å±æ€§çš„å¯¹è±¡ã€‚
- propè¦å®šä¹‰æˆ–ä¿®æ”¹çš„å±æ€§çš„åç§°ã€‚
- descriptorå°†è¢«å®šä¹‰æˆ–ä¿®æ”¹çš„å±æ€§æè¿°ç¬¦

ä¸¾ä¸ªä¾‹å­å¦‚ä¸‹ğŸ‘‡ ![img](https://user-gold-cdn.xitu.io/2020/5/12/17207b8e733a5eaf?imageView2/0/w/1280/h/960/ignore-error/1)

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°descriptorä¸­ï¼Œä¹Ÿå°±æ˜¯ç¬¬ä¸‰ä¸ªå‚æ•°ä¸­æœ‰ä¸ªå­—æ®µenumerableï¼Œå«æè¿°å¯¹è±¡çš„enumerableå±æ€§ï¼Œæˆ‘ä»¬ç§°ä¸ºâ€å¯æšä¸¾æ€§â€œ

é‚£å¯æšä¸¾æ€§å’Œä¸å¯æšä¸¾æ€§æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿä½ çœ‹çœ‹ä¸‹é¢è¿™ä¸ªä¾‹å­åº”è¯¥å°±æ¸…æ¥šäº†ï¼Œå¦‚æœæ˜¯ä¸å¯æšä¸¾åˆ™ä¸æ˜¾ç¤ºï¼Œåä¹‹å³å¯ï¼Œä¹Ÿå°±æ˜¯å½“enumerableä¸ºfalseï¼Œåªè¿”å›ç»™å®šå¯¹è±¡çš„è‡ªèº«å¯æšä¸¾å±æ€§

![img](https://user-gold-cdn.xitu.io/2020/5/12/17207ba8bc266378?imageView2/0/w/1280/h/960/ignore-error/1) åŒæ ·çš„ä¸‹é¢å‡ ç§æ–¹å¼ä¹Ÿæ˜¯åŒæ ·çš„æ€è·¯ï¼ˆåªè¿”å›ç»™å®šå¯¹è±¡çš„è‡ªèº«å¯æšä¸¾å±æ€§ï¼‰

![img](https://user-gold-cdn.xitu.io/2020/5/12/17207bc7f795fe57?imageView2/0/w/1280/h/960/ignore-error/1)

ä¸€ä¸å°å¿ƒåˆèŠåäº†ï¼Œå›å½’æ­£é¢˜ï¼Œå½“æˆ‘ä»¬æˆåŠŸå¯¼å‡ºAPIé…ç½®æ–‡ä»¶åï¼Œæ¥ä¸‹æ¥å°±æ˜¯å¦‚ä½•ä½¿ç”¨äº†

- å¦‚ä½•ä½¿ç”¨

å°†é…ç½®æŒ‚è½½åˆ°vueå¯¹è±¡åŸå‹ä¸Š

![img](https://user-gold-cdn.xitu.io/2020/5/12/17207c5c08f69cd8?imageView2/0/w/1280/h/960/ignore-error/1)

æ­£ç¡®è°ƒç”¨å§¿åŠ¿ï¼š ![img](https://user-gold-cdn.xitu.io/2020/5/12/17207c4c4e4b9ca9?imageView2/0/w/1280/h/960/ignore-error/1)