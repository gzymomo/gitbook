[TOC]

- [SpringCloud简介与微服务架构](https://www.cnblogs.com/mpolaris/p/14300886.html)



# 1、Spring Cloud

Spring Cloud 是实现微服务思想落地开发的一整套技术的集合。
Spring Cloud专注于提供良好的开箱即用经验的典型用例和可扩展性机制覆盖。

- 分布式/版本化配置
- 服务注册和发现
- 路由
- service - to - service调用
- 负载均衡
- 断路器
- 分布式消息传递

Spring Cloud上下文为Spring Cloud应用程序（引导上下文，加密，刷新范围和环境端点）的ApplicationContext提供实用程序和特殊服务。Spring Cloud Commons是一组在不同的Spring Cloud实现中使用的抽象和常用类（例如Spring Cloud Netflix vs. Spring Cloud Consul）。

## 1.1 Spring Cloud和Dubbo的区别图解
![](https://img2018.cnblogs.com/blog/1654189/202001/1654189-20200127222343299-1071763521.png)

## 1.2 微服务的技术栈

![](https://www.showdoc.cc/server/api/common/visitfile/sign/8b2c1e4ebc12bfd1e446f29d7a369736?showdoc=.jpg)

# 2、Spring Cloud 概述
## 2.1 SpringBoot和SpringCloud的区别？
- SpringBoot专注于快速方便的开发单个个体微服务。
- SpringCloud是关注全局的微服务协调整理治理框架，它将SpringBoot开发的一个个单体微服务整合并管理起来，
- 为各个微服务之间提供，配置管理、服务发现、断路器、路由、微代理、事件总线、全局锁、决策竞选、分布式会话等等集成服务
- SpringBoot可以离开SpringCloud独立使用开发项目， 但是SpringCloud离不开SpringBoot ，属于依赖的关系
- SpringBoot专注于快速、方便的开发单个微服务个体，SpringCloud关注全局的服务治理框架。

# 3、Eureka
## 3.1 Eureka和ZooKeeper都可以提供服务注册与发现的功能,请说说两个的区别
1、 ZooKeeper中的节点服务挂了就要选举 在选举期间注册服务瘫痪,虽然服务最终会恢复,但是选举期间不可用的， 选举就是改微服务做了集群，必须有一台主其他的都是从
2、 Eureka各个节点是平等关系,服务器挂了没关系，只要有一台Eureka就可以保证服务可用，数据都是最新的。 如果查询到的数据并不是最新的，就是因为Eureka的自我保护模式导致的
3、 Eureka本质上是一个工程,而ZooKeeper只是一个进程
4、 Eureka可以很好的应对因网络故障导致部分节点失去联系的情况,而不会像ZooKeeper 一样使得整个注册系统瘫痪
5、 ZooKeeper保证的是CP，Eureka保证的是AP

> CAP： C：一致性>Consistency; 取舍：(强一致性、单调一致性、会话一致性、最终一致性、弱一致性) A：可用性>Availability; P：分区容错性>Partition tolerance;

# 4、Zuul
## 4.1 什么是网关?
网关相当于一个网络服务架构的入口，所有网络请求必须通过网关转发到具体的服务。
## 4.2 网关的作用是什么
统一管理微服务请求，权限控制、负载均衡、路由转发、监控、安全控制黑名单和白名单等
## 4.3 什么是Spring Cloud Zuul（服务网关）
- Zuul是对SpringCloud提供的成熟对的路由方案，他会根据请求的路径不同，网关会定位到指定的微服务，并代理请求到不同的微服务接口，他对外隐蔽了微服务的真正接口地址。 三个重要概念：动态路由表，路由定位，反向代理：

*  动态路由表：Zuul支持Eureka路由，手动配置路由，这俩种都支持自动更新
*  路由定位：根据请求路径，Zuul有自己的一套定位服务规则以及路由表达式匹配
*  反向代理：客户端请求到路由网关，网关受理之后，在对目标发送请求，拿到响应之后在 给客户端
- 它可以和Eureka,Ribbon,Hystrix等组件配合使用，
- Zuul的应用场景：

*  对外暴露，权限校验，服务聚合，日志审计等

## 4.4 网关与过滤器有什么区别
网关是对所有服务的请求进行分析过滤，过滤器是对单个服务而言。

## 4.5 常用网关框架有那些？
Nginx、Zuul、Gateway

## 4.6 Zuul与Nginx有什么区别？
Zuul是java语言实现的，主要为java服务提供网关服务，尤其在微服务架构中可以更加灵活的对网关进行操作。Nginx是使用C语言实现，性能高于Zuul，但是实现自定义操作需要熟悉lua语言，对程序员要求较高，可以使用Nginx做Zuul集群。

## 4.7 ZuulFilter常用有那些方法
- Run()：过滤器的具体业务逻辑
- shouldFilter()：判断过滤器是否有效
- filterOrder()：过滤器执行顺序
- filterType()：过滤器拦截位置

# 5、Ribbon
## 5.1 Ribbon是什么？
- Ribbon是Netflix发布的开源项目，主要功能是提供客户端的软件负载均衡算法
- Ribbon客户端组件提供一系列完善的配置项，如连接超时，重试等。简单的说，就是在配置文件中列出后面所有的机器，Ribbon会自动的帮助你基于某种规则（如简单轮询，随即连接等）去连接这些机器。我们也很容易使用Ribbon实现自定义的负载均衡算法。（有点类似Nginx）

## 5.2 Nginx与Ribbon的区别
- Nginx是反向代理同时可以实现负载均衡，nginx拦截客户端请求采用负载均衡策略根据upstream配置进行转发，相当于请求通过nginx服务器进行转发。Ribbon是客户端负载均衡，从注册中心读取目标服务器信息，然后客户端采用轮询策略对服务直接访问，全程在客户端操作。

## 5.3 Ribbon底层实现原理
Ribbon使用discoveryClient从注册中心读取目标服务信息，对同一接口请求进行计数，使用%取余算法获取目标服务集群索引，返回获取到的目标服务信息。

## 5.4 @LoadBalanced注解的作用
开启客户端负载均衡。

# 6、Hystrix
## 6.1 什么是断路器
- 当一个服务调用另一个服务由于网络原因或自身原因出现问题，调用者就会等待被调用者的响应 当更多的服务请求到这些资源导致更多的请求等待，发生连锁效应（雪崩效应）
- 断路器有三种状态

> 打开状态：一段时间内 达到一定的次数无法调用 并且多次监测没有恢复的迹象 断路器完全打开 那么下次请求就不会请求到该服务
> 半开状态：短时间内 有恢复迹象 断路器会将部分请求发给该服务，正常调用时 断路器关闭
> 关闭状态：当服务一直处于正常状态 能正常调用

## 6.2 什么是 Hystrix？
- 在分布式系统，我们一定会依赖各种服务，那么这些个服务一定会出现失败的情况，就会导致雪崩，Hystrix就是这样的一个工具，防雪崩利器，它具有服务降级，服务熔断，服务隔离，监控等一些防止雪崩的技术。
- Hystrix有四种防雪崩方式:

*  服务降级：接口调用失败就调用本地的方法返回一个空
*  服务熔断：接口调用失败就会进入调用接口提前定义好的一个熔断的方法，返回错误信息
*  服务隔离：隔离服务之间相互影响
*  服务监控：在服务发生调用时,会将每秒请求数、成功请求数等运行指标记录下来。

## 6.3 谈谈服务雪崩效应
- 雪崩效应是在大型互联网项目中，当某个服务发生宕机时，调用这个服务的其他服务也会发生宕机，大型项目的微服务之间的调用是互通的，这样就会将服务的不可用逐步扩大到各个其他服务中，从而使整个项目的服务宕机崩溃.发生雪崩效应的原因有以下几点
- 单个服务的代码存在bug. 2请求访问量激增导致服务发生崩溃(如大型商城的枪红包，秒杀功能). 3.服务器的硬件故障也会导致部分服务不可用.

## 6.4 在微服务中，如何保护服务?
- 一般使用使用Hystrix框架，实现服务隔离来避免出现服务的雪崩效应，从而达到保护服务的效果。当微服务中，高并发的数据库访问量导致服务线程阻塞，使单个服务宕机，服务的不可用会蔓延到其他服务，引起整体服务灾难性后果，使用服务降级能有效为不同的服务分配资源,一旦服务不可用则返回友好提示，不占用其他服务资源，从而避免单个服务崩溃引发整体服务的不可用.

## 6.5 服务雪崩效应产生的原因
- 因为Tomcat默认情况下只有一个线程池来维护客户端发送的所有的请求，这时候某一接口在某一时刻被大量访问就会占据tomcat线程池中的所有线程，其他请求处于等待状态，无法连接到服务接口。

## 6.6 谈谈服务降级、熔断、服务隔离
- 服务降级：当客户端请求服务器端的时候，防止客户端一直等待，不会处理业务逻辑代码，直接返回一个友好的提示给客户端。
- 服务熔断是在服务降级的基础上更直接的一种保护方式，当在一个统计时间范围内的请求失败数量达到设定值（requestVolumeThreshold）或当前的请求错误率达到设定的错误率阈值（errorThresholdPercentage）时开启断路，之后的请求直接走fallback方法，在设定时间（sleepWindowInMilliseconds）后尝试恢复。
- 服务隔离就是Hystrix为隔离的服务开启一个独立的线程池，这样在高并发的情况下不会影响其他服务。服务隔离有线程池和信号量两种实现方式，一般使用线程池方式。

## 6.7 服务降级底层是如何实现的？
- Hystrix实现服务降级的功能是通过重写HystrixCommand中的getFallback()方法，当Hystrix的run方法或construct执行发生错误时转而执行getFallback()方法。
