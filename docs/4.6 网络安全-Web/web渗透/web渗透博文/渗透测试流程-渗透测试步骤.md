渗透测试流程-渗透测试步骤

# 一、明确目标
1）**确定范围**：测试的范围，如：IP、域名、内外网、整站or部分模块；
2）**确定规则**：能渗透到什么程度（发现漏洞为止or继续利用漏洞）、时间限制、能否修改上传、能否提权...

 - 目标系统介绍、重点保护对象及特性。
 - 是否允许数据破坏？
 - 是否允许阻断业务正常运行？
 - 测试之前是否应当知会相关部门接口人？
 - 接入方式？外网和内网？
 - 测试是发现问题就算成功，还是尽可能的发现多的问题？
 - 渗透过程是否需要考虑社会工程？
3）**确定需求**：web应用的漏洞(新上线程序)？业务逻辑漏洞（针对业务的）？人员权限管理漏洞（针对人员、权限）？
根据需求和自己技术能力来确定能不能做、能做多少

# 二、分析风险-获得授权
分析渗透测试过程中可能产生的风险，如大量测试数据的处理、影响正常业务开展、服务器发生异常的应急、数据备份和恢复、测试人力物力成本...

由测试方书写实施方案初稿并提交给客户（or本公司内部领导）进行审核。在审核完成后，从客户（or本公司内部领导）获取对测试方进行书面委托授权书，授权测试方进行渗透测试。

# 三、信息收集
在信息收集阶段，我们需要尽量多的收集关于目标系统的各种信息，比如：脚本语言的类型、服务器的类型、目录的结构、使用的开源软件、数据库类型、所有链接页面，用到的框架等。
**方式**：主动扫描；开放搜索
**开放搜索**：利用搜索引擎获得后台、未授权页面、敏感url
 - 基础信息：IP，网段，域名，端口
 - 系统信息：操作系统版本
 - 应用信息：各端口的应用，例如web应用，邮件应用等
 - 版本信息：所有探测到的版本
 - 服务信息：服务器类型、版本
 - 人员信息：域名注册人员信息，web应用中网站发帖人的id，管理员姓名等
 - 防护信息：试着看能否探测到防护设备

# 四、漏洞探测（手动&自动）
利用上一步中列出的信息，使用相应的漏洞检测

## 4.1 方法：
1）漏扫：AWVS、AppScan...
2）结合漏洞去exploit-db等位置找利用
3）在网上寻找验证POC

## 4.2 内容：
 - 系统漏洞：系统没有及时打补丁
 - Websever漏洞：Websever配置问题
 - Web应用漏洞：Web应用开发问题
 - 其它端口服务漏洞：各种21/8080(st2)/7001/22/3389
 - 通信安全：明文传输，token在cookie中传送等

# 五、漏洞验证
将上一步中发现的有可能可以成功利用的全部漏洞都验证一遍。结合实际情况，搭建模拟环境进行试验，成功后再应用于目标中。

 - 自动化验证：结合自动化扫描工具提供的结果
 - 手工验证：根据公开资源进行验证
 - 试验验证：自己搭建模拟环境进行验证
 - 登录猜解：有时可以尝试猜解一下登陆口的账号密码等信息
 - 业务漏洞验证：如发现业务漏洞，要进行验证
 - 公开资源的利用
  - exploit-db/wooyun/
  - 渗透代码网站
  - 通用、缺省口令
  - 厂商的漏洞警告等

# 六、信息分析
为下一步实施渗透做准备
 - 精准攻击：准备好上一步探测到的漏洞exp（漏洞利用），用来精准攻击
 - 绕过防御机制：是否有防火墙等设备，如何绕过
 - 定制攻击路径：最佳工具路径，根据薄弱入口，高内网权限位置，最终目标
 - 绕过检测机制：是否有检测机制，流量监控，杀毒软件，恶意代码检测等（免杀）
 - 攻击代码：经过试验得来的代码，包括不限于xss代码，sql注入语句等

# 七、利用漏洞-获取数据
 - 实施攻击：根据前几步的结果，进行攻击
 - 获取内部信息：基础设施（网络连接，vpn，路由，拓扑等）
 - 进一步渗透：内网入侵，敏感目标
 - 持续性存在：一般对客户做渗透不需要。rookit，后门，添加管理账号，驻扎手法等
 - 清理痕迹：清理相关日志（访问，操作），上传文件等

# 八、信息整理
 - 整理渗透工具：整理渗透过程中用到的代码，poc，exp等
 - 整理收集信息：整理渗透过程中收集到的一切信息
 - 整理漏洞信息：整理渗透过程中遇到的各种漏洞，各种脆弱位置信息
目的：为了最后形成报告，形成测试结果使用。

# 九、形成报告
 - 按需整理：按照之前第一步跟客户确定好的范围，需求来整理资料，并将资料形成报告
 - 补充介绍：要对漏洞成因，验证过程和带来危害进行分析
 - 修补建议：当然要对所有产生的问题提出合理高效安全的解决办法

# 十、风险规避
 1. 不要进行诸如ddos攻击，不破坏数据；
 2. 测试之前对重要数据进行备份；
 3. 任何测试执行前必须和客户进行沟通，以免引来不必要的麻烦；
 4. 可以对原始系统生成镜像环境，然后对镜像环境进行测试；
 5. 明确渗透测试范围；