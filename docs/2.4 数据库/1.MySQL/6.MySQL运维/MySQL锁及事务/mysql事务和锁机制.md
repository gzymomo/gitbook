

# 存储过程

存储过程是SQL语句和控制语句预编译集合的过程，以一个名称存储并作为一个单元处理。

过程体如果为复合结构使用BEGAIN....END，复合结构可以是声明、循环、控制。
注意临时修改系统分隔符。



- 优点：增强SQL功能和灵活性；较快处理速度；减少网络流量

- 语法结构  CREATE [DIFINER ={user | current_user}] PROCEDURE sp_name ([proc_parameter[,...]] [characteristic...] routine_body

存储过程VS自定义函数：

1. 存储过程实现的功能更复杂，函数则针对性更强
2. 存储过程可以返回多个值，函数只能返回一个值
3. 存储过程一般独立来执行，函数作为SQL语句的组成部分出现



# 存储引擎

## 并发处理

当多个连接对记录进行操作时，保证数据的的一致性和完整性。
EG：有两个用户，一个用户在读取22号商品的记录，与此同时另一个用户在删除22号商品的记录。

解决方案：锁



锁分类：

- 共享锁（读锁）：同一时间内多个用户可以读取同一资源，此过程数据不会发生变化
- 排他锁（写锁）：任何时候只能有一个用户写入资源，当其写锁时会阻碍其他的读锁和写锁操作



锁颗粒：（锁定时的单位，我们只需要对修改的资源进行精确加锁。比如用户想修改用户信息，只需要对用户表加锁，而不需要对商品表加锁。）

- 表锁，开销最小的策略
- 行锁，开销最大的策略

## 事务处理

事务，是数据库区别于文件系统的重要标志之一，保证数据库的完整性。
将多个过程通过严格的标准来看作一个整体过程。
用户A转200元给B用户可以分为两个过程；A账户减200元；B账户增200元。我们应将起看作一个完整过程，哪一个环节出错了，都应该将所有涉及的数据恢复初始状态。



特性：

- 原子性（Atomicity）
- 一致性（Consistency）
- 隔离性（Isolation）
- 持久性（Durability）



## 引擎比较

MyISAM 适用事务处理不多的情况。
InnoDB 适用事务处理较多，且需要外键的情况。



![](../../img/mysql引擎比较.png)