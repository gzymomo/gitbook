# è½¯ä»¶æµ‹è¯•æŠ¥å‘Š

# **1.**å¼•è¨€

## 1.1 ç›®çš„

â€‹	å»ºç«‹èµ·ä¸€å¥—è½¯ä»¶æµ‹è¯•è§„èŒƒæ–‡æ¡£ï¼Œé€šè¿‡è¯¥è§„èŒƒæ–‡æ¡£ï¼Œèƒ½å¤Ÿä¸ºå…¬å¸æä¾›ä¸€ä¸ªç›¸å…³æ–¹é¢çš„æµ‹è¯•æ ‡å‡†ï¼ŒåŒ…å«æµ‹è¯•å†…å®¹æœ‰æ€§èƒ½æµ‹è¯•ï¼ŒåŸºå‡†æµ‹è¯•ï¼Œå®‰å…¨æµ‹è¯•ï¼Œæ¸—é€æµ‹è¯•ç­‰ç›¸å…³å†…å®¹ã€‚å¹¶åˆ©ç”¨ç›¸å…³å·¥å…·èƒ½å¤Ÿå®ç°å¯¹å¿…è¦é¡¹ç›®å®æ–½å®Œæ•´çš„æµ‹è¯•æµç¨‹ï¼Œæä¾›ä¸€ä¸ªæ ‡å‡†çš„æµ‹è¯•æ–‡æ¡£ã€‚ç›®å‰è¯¥æ–¹é¢å¤„äºæ‘¸ç´¢å½“ä½œï¼Œè‡ªå·±å¯¹æµ‹è¯•ç›¸å…³è¡Œä¸šçš„å‚¨å¤‡ä¸æ˜¯ç‰¹åˆ«æ·±ï¼Œåœ¨ä¸æ–­å­¦ä¹ çš„é“è·¯ä¸Šä¸æ–­å®Œå–„è¯¥æµ‹è¯•æŠ¥å‘Šï¼Œæœ€ç»ˆå¾—ä»¥å®è·µã€‚



## 1.2 æµ‹è¯•èŒƒå›´å’Œå†…å®¹

### 1.2.1 åŸºå‡†æµ‹è¯•

åŸºå‡†æµ‹è¯•ï¼š

- sysbenchè¿›è¡Œcpuæ€§èƒ½åŸºå‡†æµ‹è¯•ã€‚

- sysbenchè¿›è¡Œæ–‡ä»¶i/oæ€§èƒ½åŸºå‡†æµ‹è¯•ã€‚

- sysbenchè¿›è¡Œå†…å­˜é€Ÿåº¦åŸºå‡†æµ‹è¯•ã€‚

- sysbenchè¿›è¡Œçº¿ç¨‹å­ç³»ç»Ÿæ€§èƒ½æµ‹è¯•ã€‚

- sysbenchè¿›è¡Œmysqlæ€§èƒ½åŸºå‡†æµ‹è¯•ã€‚

### 1.2.2 æ€§èƒ½æµ‹è¯•

æ€§èƒ½å‹æµ‹ï¼š

- jmeterè¿›è¡Œæ•°æ®åº“æ€§èƒ½å‹æµ‹ã€‚

- jmeterè¿›è¡Œhttpæ¥å£å‹æµ‹ã€‚

### 1.2.3 å®‰å…¨æµ‹è¯•



### 1.2.4 æ¸—é€æµ‹è¯•



# 2.åŸºå‡†æµ‹è¯•

ä»¥ä¸‹åˆ†åˆ«æè¿°æµ‹è¯•è¿‡ç¨‹ä¸­ä¸»è¦çš„å„é¡¹æ´»åŠ¨ï¼Œä»‹ç»æµ‹è¯•è¿‡ç¨‹å†…å®¹ï¼Œé‡åˆ°çš„é—®é¢˜ï¼Œä»¥åŠå…¶å®ƒå‘ç”Ÿçš„ä¸»è¦äº‹ä»¶ã€‚**ä¸‹é¢çš„æ•°æ®ç»Ÿè®¡æœ€å¥½ä»¥è¡¨æ ¼ï¼Œæˆ–æ¡å½¢å›¾ã€é¥¼çŠ¶å›¾çš„å½¢å¼å±•ç°**

## 2.1. æµ‹è¯•è¿‡ç¨‹

### 2.1.1æœåŠ¡å™¨é…ç½®ä¿¡æ¯æŸ¥çœ‹

ç¼–å†™bashè„šæœ¬ï¼ŒæŸ¥çœ‹æœåŠ¡å™¨åŸºç¡€é…ç½®ä¿¡æ¯ã€‚

```bash
vi showServerConfig.sh
# èµ‹äºˆè„šæœ¬æ‰§è¡Œæƒé™
chmod +x showServerConfig.sh
```



å…·ä½“è„šæœ¬å†…å®¹å¦‚ä¸‹ï¼š

```bash
#!/bin/bash
echo ======= cpuä¸ªæ•°ï¼š =======
grep 'physical id' /proc/cpuinfo | sort -u | wc -l
echo ======= cpuæ ¸æ•°ï¼š =======
cat /proc/cpuinfo | grep "cpu cores" | uniq
echo ======= cpuå‹å·ï¼š =======
cat /proc/cpuinfo | grep 'model name' |uniq
echo ======= cpuå†…æ ¸é¢‘ç‡ï¼š =======
cat /proc/cpuinfo |grep MHz|uniq
echo ======= cpuç»Ÿè®¡ä¿¡æ¯ï¼š =======
lscpu
echo ======= å†…å­˜æ€»æ•°ï¼š =======
cat /proc/meminfo | grep MemTotal
echo ======= å†…æ ¸ç‰ˆæœ¬ï¼š =======
cat /proc/version
echo ======= æ“ä½œç³»ç»Ÿå†…æ ¸ä¿¡æ¯ï¼š =======
uname -a
echo ======= ç£ç›˜ä¿¡æ¯ï¼š =======
fdisk -l
```

 

### 2.1.2é€šè¿‡sysbenchè¿›è¡ŒåŸºå‡†æµ‹è¯•

- sysbenchè¿›è¡Œcpuæ€§èƒ½åŸºå‡†æµ‹è¯•ã€‚
- sysbenchè¿›è¡Œæ–‡ä»¶i/oæ€§èƒ½åŸºå‡†æµ‹è¯•ã€‚
- sysbenchè¿›è¡Œå†…å­˜é€Ÿåº¦åŸºå‡†æµ‹è¯•ã€‚
- sysbenchè¿›è¡Œçº¿ç¨‹å­ç³»ç»Ÿæ€§èƒ½æµ‹è¯•ã€‚
- sysbenchè¿›è¡Œmysqlæ€§èƒ½åŸºå‡†æµ‹è¯•ã€‚



 sysbenchè¿›è¡Œå‹åŠ›æµ‹è¯•è¿‡ç¨‹ï¼š

1.  prepareé˜¶æ®µï¼Œè¿™ä¸ªé˜¶æ®µæ˜¯ç”¨æ¥åšå‡†å¤‡çš„ï¼Œå¯¹æ‰€éœ€æµ‹è¯•çš„è¡¨ï¼Œæ·»åŠ æµ‹è¯•æ•°æ®ã€‚
2.  run é˜¶æ®µè¿›è¡Œæ•°æ®åº“å‹åŠ›æµ‹è¯•ã€‚
3.  cleanup é˜¶æ®µå»æ¸…é™¤æµ‹è¯•æ•°æ®ï¼Œä¹Ÿå°±æ˜¯å°†prepareé˜¶æ®µçš„æ•°æ®è¿›è¡Œæ¸…é™¤ã€‚

 

#### æ•°æ®åº“åŸºå‡†æµ‹è¯•

##### æ•°æ®åº“æµ‹è¯•å‚æ•°è¯´æ˜

```bash
General database options:

  --db-driver=STRING  specifies database driver to use ('help' to get list of available drivers) [mysql] #æŒ‡å®šæ•°æ®åº“é©±åŠ¨ï¼Œé»˜è®¤æ˜¯mysql
  --db-ps-mode=STRING prepared statements usage mode {auto, disable} [auto]                              #
  --db-debug[=on|off] print database-specific debug information [off]                                    #dubugæ¨¡å¼


Compiled-in database drivers:
  mysql - MySQL driver

mysql options:
  --mysql-host=[LIST,...]          MySQL server host [localhost]
  --mysql-port=[LIST,...]          MySQL server port [3306]
  --mysql-socket=[LIST,...]        MySQL socket
  --mysql-user=STRING              MySQL user [sbtest]
  --mysql-password=STRING          MySQL password []
  --mysql-db=STRING                MySQL database name [sbtest]              #æ•°æ®åº“åå­—ï¼Œé»˜è®¤æ˜¯sbtest
  --mysql-ssl[=on|off]             use SSL connections, if available in the client library [off]  #ä»¥ä¸‹æ˜¯sslçš„è¿æ¥æµ‹è¯•
  --mysql-ssl-key=STRING           path name of the client private key file
  --mysql-ssl-ca=STRING            path name of the CA file
  --mysql-ssl-cert=STRING          path name of the client public key certificate file
  --mysql-ssl-cipher=STRING        use specific cipher for SSL connections []
  --mysql-compression[=on|off]     use compression, if available in the client library [off]      #å‹ç¼©æµ‹è¯•
  --mysql-debug[=on|off]           trace all client library calls [off]
  --mysql-ignore-errors=[LIST,...] list of errors to ignore, or "all" [1213,1020,1205]            #å¿½ç•¥çš„é”™è¯¯
  --mysql-dry-run[=on|off]         Dry run, pretend that all MySQL client API calls are successful without executing them [off]
```

##### æ•°æ®åº“æµ‹è¯•å®è·µ

- prepare

é¦–å…ˆåˆ›å»ºä¸€ä¸ªæ•°æ®åº“ï¼š`create database sbtest; `ï¼Œç„¶åå¼€å§‹å‡†å¤‡æ•°æ®ï¼š

```bash
sysbench /data/sysbench-master/src/lua/oltp_read_write.lua --tables=3 --table_size=10000000 --mysql-user=root --mysql-password=123456 --mysql-host=10.0.102.214 --mysql-port=3306 --mysql-db=sbtest prepare
```

- run

```bash
sysbench /data/sysbench-master/src/lua/oltp_point_select.lua --tables=3 --table_size=10000000 --mysql-user=root --mysql-password=123456 --mysql-host=10.0.102.214 --mysql-port=3306 --mysql-db=sbtest --threads=128 --time=100 --report-interval=5 run
```

- æµ‹è¯•ç»“æœåˆ†æ

```bash
SQL statistics:
    queries performed:
        read:                            2638920   #æ€»çš„selectæ•°é‡
        write:                           0
        other:                           0
        total:                           2638920
    transactions:                        2638920 (26382.71 per sec.)   #TPS
    queries:                             2638920 (26382.71 per sec.)   #QPS
    ignored errors:                      0      (0.00 per sec.)        #å¿½ç•¥çš„é”™è¯¯
    reconnects:                          0      (0.00 per sec.)        #é‡æ–°è¿æ¥

Throughput:
    events/s (eps):                      26382.7081                   #æ¯ç§’çš„äº‹ä»¶æ•°ï¼Œä¸€èˆ¬å’ŒTPSä¸€æ ·
    time elapsed:                        100.0246s                    #æµ‹è¯•çš„æ€»æ—¶é—´
    total number of events:              2638920                      #æ€»çš„äº‹ä»¶æ•°ï¼Œä¸€èˆ¬å’ŒTPSä¸€æ ·

Latency (ms):
         min:                                    0.11          #æœ€å°å“åº”æ—¶é—´
         avg:                                    4.85          #å¹³å‡å“åº”æ—¶é—´
         max:                                  649.29          #æœ€å¤§å“åº”æ—¶é—´
         95th percentile:                       25.74          #95%çš„å“åº”æ—¶é—´æ˜¯è¿™ä¸ªæ•°æ®  
         sum:                             12796148.28

Threads fairness:
    events (avg/stddev):           20616.5625/196.08
    execution time (avg/stddev):   99.9699/0.00#åœ¨è¿™ä¸ªæµ‹è¯•ä¸­ï¼Œå¯ä»¥çœ‹åˆ°TPSä¸QPSçš„å¤§å°åŸºæœ¬ä¸€è‡´ï¼Œè¯´æ˜è¿™ä¸ªluaè„šæœ¬ä¸­çš„ä¸€ä¸ªæŸ¥è¯¢ä¸€èˆ¬å°±æ˜¯ä¸€ä¸ªäº‹åŠ¡ï¼
```

ä¸€èˆ¬å…³æ³¨çš„æŒ‡æ ‡ä¸»è¦æœ‰:

- - response time avgï¼šå¹³å‡å“åº”æ—¶é—´ï¼ˆåé¢çš„95%çš„å¤§å°å¯ä»¥é€šè¿‡â€“percentile=98çš„æ–¹å¼å»æ›´æ”¹ï¼‰ã€‚
- - transactionsï¼šç²¾ç¡®çš„è¯´æ˜¯è¿™ä¸€é¡¹åé¢çš„TPSï¼Œä½†å¦‚æœä½¿ç”¨äº†â€“skip-trx=onï¼Œè¿™é¡¹äº‹åŠ¡æ•°ä¸º0ï¼Œéœ€è¦ç”¨total number of eventså»é™¤ä»¥æ€»æ—¶é—´ï¼Œå¾—åˆ°tpsï¼ˆå…¶å®è¿˜å¯ä»¥åˆ†ä¸ºè¯»tpså’Œå†™tpsï¼‰ã€‚
- - queriesï¼šç”¨å®ƒé™¤ä»¥æ€»æ—¶é—´ï¼Œå¾—åˆ°ååé‡QPSã€‚

åˆšå¼€å§‹çš„æ—¶å€™æœ‰ä¸€ä¸ªæ˜æ˜¾çš„ä¸Šå‡ï¼Œè¿™æ—¶å€™æ˜¯å› ä¸ºåœ¨bpä¸­æ²¡æœ‰ç¼“å­˜æ•°æ®ï¼Œéœ€è¦ä»ç£ç›˜ä¸­è¯»æ•°æ®ï¼Œä¹Ÿå°±æ˜¯é¢„çƒ­é˜¶æ®µï¼

- cleanup

```bash
sysbench /data/sysbench-master/src/lua/oltp_read_write.lua --tables=3 --table_size=10000000 --mysql-user=root --mysql-password=123456 --mysql-host=10.0.102.214 --mysql-port=3306 --mysql-db=sbtest cleanup
```





####  I/OåŸºå‡†æµ‹è¯•

##### I/Oæµ‹è¯•å‚æ•°è¯´æ˜

```bash
[root@test3 ~]# sysbench fileio help               #æŸ¥çœ‹IOæµ‹è¯•çš„æ–‡æ¡£
sysbench 1.1.0 (using bundled LuaJIT 2.1.0-beta3)

fileio options:
  --file-num=N                  number of files to create [128]              #æ–‡ä»¶çš„æ•°é‡
  --file-block-size=N           block size to use in all IO operations [16384] #æ–‡ä»¶å—çš„å¤§å°ï¼Œå¦‚æœè¦æ˜¯é’ˆå¯¹INNODBçš„æµ‹è¯•ï¼Œå¯ä»¥è®¾ç½®ä¸ºinnodb_page_sizeçš„å¤§å°
  --file-total-size=SIZE        total size of files to create [2G]             #æ–‡ä»¶çš„æ€»å¤§å°
  --file-test-mode=STRING       test mode {seqwrã€é¡ºåºå†™ã€‘, seqrewrã€é¡ºåºè¯»å†™ã€‘, seqrdã€é¡ºåºè¯»ã€‘, rndrdã€éšæœºè¯»ã€‘, rndwrã€éšæœºå†™ã€‘, rndrwã€éšæœºè¯»å†™ã€‘} #æ–‡ä»¶æµ‹è¯•æ¨¡å¼
  --file-io-mode=STRING         file operations mode {syncã€åŒæ­¥ã€‘,asyncã€å¼‚æ­¥ã€‘,mmapã€mapæ˜ å°„ã€‘} [é»˜è®¤ä¸ºï¼šsync]          #æ–‡ä»¶çš„ioæ¨¡å¼
  --file-async-backlog=N        number of asynchronous operatons to queue per thread [128] #æ‰“å¼€æ–‡ä»¶æ—¶çš„é€‰é¡¹ï¼Œè¿™æ˜¯ä¸APIç›¸å…³çš„å‚æ•°ã€‚
  --file-extra-flags=[LIST,...] #æ‰“å¼€æ–‡ä»¶æ—¶çš„é€‰é¡¹ï¼Œè¿™æ˜¯ä¸APIç›¸å…³çš„å‚æ•°ã€‚å¯é€‰æœ‰syncï¼Œdsyncï¼Œdirectã€‚--file-fsync-freq=N           #æ‰§è¡Œfsyncå‡½æ•°çš„é¢‘ç‡ï¼Œfsyncä¸»è¦æ˜¯åŒæ­¥ç£ç›˜æ–‡ä»¶ï¼Œå› ä¸ºå¯èƒ½æœ‰ç³»ç»Ÿå’Œç£ç›˜ç¼“å†²çš„å…³ç³»ã€‚é»˜è®¤ä¸º100ï¼Œå¦‚æœä¸º0è¡¨ç¤ºä¸ä½¿ç”¨fsyncã€‚
  --file-fsync-all[=on|off]     #æ¯æ‰§è¡Œå®Œä¸€æ¬¡å†™æ“ä½œï¼Œå°±æ‰§è¡Œä¸€æ¬¡fsyncï¼Œé»˜è®¤æœªoffã€‚--file-fsync-end[=on|off]     #åœ¨æµ‹è¯•ç»“æŸæ—¶ï¼Œæ‰§è¡Œfsyncï¼Œé»˜è®¤ä¸ºonã€‚--file-fsync-mode=STRING      #æ–‡ä»¶åŒæ­¥å‡½æ•°çš„é€‰æ‹©ï¼ŒåŒæ ·æ˜¯å’ŒAPIç›¸å…³çš„å‚æ•°ï¼Œç”±äºå¤šä¸ªæ“ä½œå¯¹fdatasyncæ”¯æŒçš„ä¸åŒï¼Œå› æ­¤ä¸å»ºè®®ä½¿ç”¨fdatasyncã€‚é»˜è®¤ä¸ºfsyncã€‚--file-merged-requests=N      #å°½å¯èƒ½åˆå¹¶æ­¤æ•°é‡çš„ioè¯·æ±‚(0-ä¸åˆå¹¶)ï¼Œé»˜è®¤ä¸º[0]ã€‚
  --file-rw-ratio=N             #æµ‹è¯•æ—¶çš„è¯»å†™æ¯”ä¾‹ï¼Œé»˜è®¤æ˜¯2:1ã€‚
```

##### I/Oæµ‹è¯•å®è·µ

- prepare

```bash
sysbench fileio --file-num=10 --file-total-size=50G prepare
```

- run(è¿™é‡Œè¿›è¡Œéšæœºè¯»å†™æµ‹è¯•)

```bash
sysbench fileio --file-num=10 --file-total-size=50G --file-block-size=16384 --file-test-mode=rndrw --file-io-mode=sync --file-extra-flags=direct --time=100  --threads=16 --report-interval=10 run
```

- - é¡ºåºè¯»çš„æµ‹è¯•

  ```bash
  sysbench fileio --file-num=10 --file-total-size=50G --file-block-size=16384 --file-test-mode=seqrd --file-io-mode=sync --file-extra-flags=direct --time=100  --threads=16 --report-interval=10 run
  ```

- cleanup

```bash
sysbench fileio --file-num=10 --file-total-size=50 cleanup
```

#### ç£ç›˜I/Oæµ‹è¯•

- prepare 

```bash
sysbench --test=fileio --file-num=16 --file-total-size=2G prepare
```

å‚æ•°å«ä¹‰ï¼š
â€“test=fileio æµ‹è¯•çš„åç§°å«åš fileio
â€“file-num=16 æ–‡ä»¶çš„æ•°é‡æ˜¯ 16 ä¸ª
â€“file-total-size=2G æ–‡ä»¶çš„æ€»ä½“å¤§å°æ˜¯ 2GB



- æµ‹è¯•å¤šçº¿ç¨‹ä¸‹å°IOçš„éšæœºåªè¯»æ€§èƒ½

```bash
sysbench --test=fileio --file-num=16 --file-total-size=2G --file-test-mode=rndrd  --file-extra-flags=direct --file-fsync-freq=0 --file-block-size=16384 run
```

å‚æ•°å«ä¹‰ï¼š
â€“test=fileio æµ‹è¯•çš„åç§°å«åš fileio
â€“file-num=16 æ–‡ä»¶çš„æ•°é‡æ˜¯ 16 ä¸ª
â€“file-total-size=2G æ–‡ä»¶çš„æ€»ä½“å¤§å°æ˜¯ 2GB
â€“file-test-mode=rndrd æµ‹è¯•æ¨¡å¼æ˜¯éšæœºè¯»å–
â€“file-extra-flags=direct ä½¿ç”¨é¢å¤–çš„æ ‡å¿—æ¥æ‰“å¼€æ–‡ä»¶{sync,dsync,direct}
â€“file-fsync-freq=0 æ‰§è¡Œ fsync() çš„é¢‘ç‡
â€“file-block-size=16384 æµ‹è¯•æ—¶æ–‡ä»¶å—çš„å¤§å°ä½ 16384 (16K)



ç»“æœåˆ†æï¼š

```bash
Throughput:
    read, MiB/s:                  23.24
    written, MiB/s:               0.00
General statistics:
    total time:                          10.0002s
    total number of events:              14877
 
Latency (ms):
         min:                                  0.15
         avg:                                  0.67
         max:                                168.34
         95th percentile:                      0.84
         sum:                               9978.66
 
Threads fairness:
    events (avg/stddev):           14877.0000/0.00
    execution time (avg/stddev):   9.9787/0.00
```

éšæœºè¯»å–çš„æ•°æ®ååé‡ï¼š23.24 MB/s
éšæœºè¯»çš„IOPSï¼š 1487.34
å¹³å‡å»¶è¿Ÿï¼š0.67æ¯«ç§’



- æµ‹è¯•å¤šçº¿ç¨‹ä¸‹å°IOçš„éšæœºå†™å…¥æ€§èƒ½

```bash
sysbench --test=fileio --file-num=16 --file-total-size=2G --file-test-mode=rndwr --max-time=180  --file-extra-flags=direct --file-fsync-freq=0 --file-block-size=16384 run
```

å‚æ•°å«ä¹‰ï¼š
â€“file-test-mode=rndwr æµ‹è¯•æ¨¡å¼æ˜¯éšæœºå†™

- æµ‹è¯•å¤šçº¿ç¨‹ä¸‹å°IOçš„éšæœºè¯»å†™æ€§èƒ½

```bash
sysbench --test=fileio --file-num=16 --file-total-size=2G --file-test-mode=rndrw --file-extra-flags=direct --file-fsync-freq=0 --file-block-size=16384 run
```

å‚æ•°å«ä¹‰ï¼š
â€“file-test-mode=rndrw  æµ‹è¯•æ¨¡å¼æ˜¯éšæœºè¯»å†™



#### File I/Oæµ‹è¯•

##### File I/Oæµ‹è¯•å‚æ•°è¯´æ˜

```bash
#/usr/local/sysbench_1/bin/sysbench fileio help
sysbench 1.0.9 (using bundled LuaJIT 2.1.0-beta2)
 
fileio options:
  --file-num=N              number of files to create [128]
  --file-block-size=N       block size to use in all IO operations [16384]
  --file-total-size=SIZE    total size of files to create [2G]
  --file-test-mode=STRING   test mode {seqwr, seqrewr, seqrd, rndrd, rndwr, rndrw}
  --file-io-mode=STRING     file operations mode {sync,async,mmap} [sync]
  --file-async-backlog=N    number of asynchronous operatons to queue per thread [128]
  --file-extra-flags=STRING additional flags to use on opening files {sync,dsync,direct} []
  --file-fsync-freq=N       do fsync() after this number of requests (0 - don't use fsync()) [100]
  --file-fsync-all[=on|off] do fsync() after each write operation [off]
  --file-fsync-end[=on|off] do fsync() at the end of test [on]
  --file-fsync-mode=STRING  which method to use for synchronization {fsync, fdatasync} [fsync]
  --file-merged-requests=N  merge at most this number of IO requests if possible (0 - don't merge) [0]
  --file-rw-ratio=N         reads/writes ratio for combined test [1.5]
```

##### File I/Oæµ‹è¯•å®è·µ

- prepareï¼ˆä¸€å®šè¦åˆ°ä½ æµ‹è¯•çš„ç£ç›˜ç›®å½•ä¸‹æ‰§è¡Œï¼Œå¦åˆ™å¯èƒ½æµ‹è¯•ç³»ç»Ÿç›˜äº†ï¼‰

```bash
sysbench fileio --file-total-size=15G --file-test-mode=rndrw --time=300 --max-requests=0 prepare
```

- run

```bash
sysbench fileio --file-total-size=15G --file-test-mode=rndrw --time=300 --max-requests=0 run
```

- cleanup

```bash
sysbench fileio --file-total-size=15G --file-test-mode=rndrw --time=300 --max-requests=0 cleanup
```



### 2.1.3é€šè¿‡wrkè¿›è¡ŒNginxåŸºå‡†æµ‹è¯•

#### å‚æ•°è¯´æ˜

```bash
Usage: wrk <options> <url>
  Options:
    -c, --connections <N>  Connections to keep open
    -d, --duration    <T>  Duration of test
    -t, --threads     <N>  Number of threads to use

    -s, --script      <S>  Load Lua script file
    -H, --header      <H>  Add header to request
        --latency          Print latency statistics
        --timeout     <T>  Socket/request timeout
    -v, --version          Print version details

  Numeric arguments may include a SI unit (1k, 1M, 1G)
  Time arguments may include a time unit (2s, 2m, 2h)
```

ä½¿ç”¨ `-t` ä¸ªçº¿ç¨‹ï¼Œæ¨¡æ‹Ÿ `-c` ä¸ªå¹¶å‘è¯·æ±‚ã€‚wrk ä½¿ç”¨**å¼‚æ­¥éé˜»å¡**çš„ io çš„æ–¹å¼ï¼Œå¹¶ä¸æ˜¯ç”¨çº¿ç¨‹å»æ¨¡æ‹Ÿå¹¶å‘è¿æ¥ï¼Œå› æ­¤ä¸éœ€è¦è®¾ç½®å¾ˆå¤šçš„çº¿ç¨‹ï¼Œä¸€èˆ¬æ ¹æ® CPU çš„æ ¸å¿ƒæ•°é‡è®¾ç½®å³å¯ã€‚

- `-c` ï¼šéœ€è¦æ¨¡æ‹Ÿçš„è¿æ¥æ•°ã€‚
- `-t` ï¼šå¹¶å‘çš„çº¿ç¨‹æ•°ã€‚
- `-d` ï¼šæµ‹è¯•çš„æµ‹è¯•æ—¶é•¿ã€‚
- `-s` ï¼šæŒ‡å®š Lua è„šæœ¬çš„è·¯å¾„ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸éœ€è¦è¿™ä¸ªå‚æ•°ã€‚
- `--header` ï¼šæŒ‡å®šè¯·æ±‚å¸¦çš„ Header å‚æ•°ã€‚
- `--latency` ï¼šæ˜¯å¦æ‰“å°è¯·æ±‚å»¶è¿Ÿç»Ÿè®¡ã€‚
- `--timeout` ï¼šè®¾ç½®è¯·æ±‚è¶…æ—¶æ—¶é—´ã€‚
- `-v` ï¼šæ˜¾ç¤º wrk ç‰ˆæœ¬ä¿¡æ¯ã€‚

#### æµ‹è¯•å®è·µ

```bash
./wrk -t50 -c400 -d30s http://127.0.0.1
```

- `-t50` å‚æ•°ï¼Œè®¾ç½® 50 å¹¶å‘çº¿ç¨‹ã€‚
- `-c400` å‚æ•°ï¼Œè®¾ç½® 400 è¿æ¥ã€‚
- `-d30s` å‚æ•°ï¼Œè®¾ç½®æ‰§è¡Œ 30s çš„æ—¶é•¿çš„ HTTP è¯·æ±‚ã€‚
- `http://127.0.0.1` å‚æ•°ï¼Œè¯·æ±‚æœ¬åœ°çš„ Nginx æœåŠ¡ã€‚



### 2.1.4é€šè¿‡redis-benchmarkè¿›è¡ŒRedisåŸºå‡†æµ‹è¯•

æ¨¡æ‹Ÿ N ä¸ªå®¢æˆ·ç«¯åŒæ—¶å‘å‡º M ä¸ªè¯·æ±‚ã€‚

#### å‚æ•°è¯´æ˜

```bash
Usage: redis-benchmark [-h <host>] [-p <port>] [-c <clients>] [-n <requests>] [-k <boolean>]

 -h <hostname>      Server hostname (default 127.0.0.1)
 -p <port>          Server port (default 6379)
 -s <socket>        Server socket (overrides host and port)
 -a <password>      Password for Redis Auth
 -c <clients>       Number of parallel connections (default 50)
 -n <requests>      Total number of requests (default 100000)
 -d <size>          Data size of SET/GET value in bytes (default 3)
 --dbnum <db>       SELECT the specified db number (default 0)
 -k <boolean>       1=keep alive 0=reconnect (default 1)
 -r <keyspacelen>   Use random keys for SET/GET/INCR, random values for SADD
  Using this option the benchmark will expand the string __rand_int__
  inside an argument with a 12 digits number in the specified range
  from 0 to keyspacelen-1. The substitution changes every time a command
  is executed. Default tests use this to hit random keys in the
  specified range.
 -P <numreq>        Pipeline <numreq> requests. Default 1 (no pipeline).
 -e                 If server replies with errors, show them on stdout.
                    (no more than 1 error per second is displayed)
 -q                 Quiet. Just show query/sec values
 --csv              Output in CSV format
 -l                 Loop. Run the tests forever
 -t <tests>         Only run the comma separated list of tests. The test
                    names are the same as the ones produced as output.
 -I                 Idle mode. Just open N idle connections and wait.
```

- - ğŸ”¥ é‡è¦ï¼šä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šè‡ªåŠ¨å¦‚ä¸‹å‚æ•°ï¼Œä»¥è¾¾åˆ°ä¸åŒåœºæ™¯ä¸‹çš„æ€§èƒ½æµ‹è¯•ã€‚

  - `-c` ï¼šå¹¶å‘çš„å®¢æˆ·ç«¯æ•°ï¼ˆæ¯ä¸ªå®¢æˆ·ç«¯ï¼Œç­‰äºä¸€ä¸ªå¹¶å‘ï¼‰ã€‚

  - `-n` ï¼šæ€»å…±å‘èµ·çš„æ“ä½œï¼ˆè¯·æ±‚ï¼‰æ•°ã€‚ä¾‹å¦‚è¯´ï¼Œä¸€æ¬¡ GET å‘½ä»¤ï¼Œç®—ä½œä¸€æ¬¡æ“ä½œã€‚

  - `-d` ï¼šæŒ‡å®š SET/GET æ“ä½œçš„æ•°æ®å¤§å°ï¼Œå•ä½ï¼šå­—èŠ‚ã€‚

  - ```
    -r
    ```

     

    ï¼šSET/GET/INCR ä½¿ç”¨éšæœº KEY ï¼ŒSADD ä½¿ç”¨éšæœºå€¼ã€‚

    - é»˜è®¤æƒ…å†µä¸‹ï¼Œä½¿ç”¨ `__rand_int__` ä½œä¸º KEY ã€‚
    - é€šè¿‡è®¾ç½® `-r` å‚æ•°ï¼Œå¯ä»¥è®¾ç½® KEY çš„éšæœºèŒƒå›´ã€‚ä¾‹å¦‚è¯´ï¼Œ`-r 10` ç”Ÿæˆçš„ KEY èŒƒå›´æ˜¯ `[0, 9)` ã€‚

  - `-P` ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼ŒRedis å®¢æˆ·ç«¯ä¸€æ¬¡è¯·æ±‚åªå‘èµ·ä¸€ä¸ªå‘½ä»¤ã€‚é€šè¿‡ `-P` å‚æ•°ï¼Œå¯ä»¥è®¾ç½®ä½¿ç”¨ [pipelining](http://www.iocoder.cn/Performance-Testing/Redis-benchmark/pipelining) åŠŸèƒ½ï¼Œä¸€æ¬¡å‘èµ·æŒ‡å®šä¸ªè¯·æ±‚ï¼Œä»è€Œæå‡ QPS ã€‚

  - `-l` ï¼šå¾ªç¯ï¼Œä¸€ç›´æ‰§è¡ŒåŸºå‡†æµ‹è¯•ã€‚

  - `-t` ï¼šæŒ‡å®šéœ€è¦æµ‹è¯•çš„ Redis å‘½ä»¤ï¼Œå¤šä¸ªå‘½ä»¤é€šè¿‡é€—å·åˆ†éš”ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæµ‹è¯• PING_INLINE/PING_BULK/SET/GET ç­‰ç­‰å‘½ä»¤ã€‚å¦‚æœèƒ–å‹åªæƒ³æµ‹è¯• SET/GET å‘½ä»¤ï¼Œåˆ™å¯ä»¥ `-t SET,GET` æ¥æŒ‡å®šã€‚

  - `-I` ï¼šIdle æ¨¡å¼ã€‚ä»…ä»…æ‰“å¼€ N ä¸ª Redis Idle ä¸ªè¿æ¥ï¼Œç„¶åç­‰å¾…ï¼Œå•¥ä¹Ÿä¸åšã€‚ä¸æ˜¯å¾ˆç†è§£è¿™ä¸ªå‚æ•°çš„ç›®çš„ï¼Œç›®å‰çŒœæµ‹ï¼Œä»…ä»…ç”¨äºå ç”¨ Redis è¿æ¥ã€‚

- è¾“å‡ºç›¸å…³ï¼š

  - `-e` ï¼šå¦‚æœ Redis Server è¿”å›é”™è¯¯ï¼Œæ˜¯å¦å°†é”™è¯¯æ‰“å°å‡ºæ¥ã€‚é»˜è®¤æƒ…å†µä¸‹ä¸æ‰“å°ï¼Œé€šè¿‡è¯¥å‚æ•°å¼€å¯ã€‚
  - `-q` ï¼šç²¾ç®€è¾“å‡ºç»“æœã€‚å³åªå±•ç¤ºæ¯ä¸ªå‘½ä»¤çš„ QPS æµ‹è¯•ç»“æœã€‚å¦‚æœä¸ç†è§£çš„èƒ–å‹ï¼Œè·‘ä¸‹è¿™ä¸ªå‚æ•°å°±å¯ä»¥å¾ˆå¥½çš„æ˜ç™½äº†ã€‚
  - `--csv` ï¼šæŒ‰ç…§ CSV çš„æ ¼å¼ï¼Œè¾“å‡ºç»“æœã€‚



#### æµ‹è¯•å®è·µ

```bash
redis-benchmark
```

åœ¨å®‰è£… Redis çš„æœåŠ¡å™¨ä¸Šï¼Œç›´æ¥æ‰§è¡Œï¼Œä¸å¸¦ä»»ä½•å‚æ•°ï¼Œå³å¯è¿›è¡Œæµ‹è¯•ã€‚

#### ç²¾ç®€æµ‹è¯•

```bash
redis-benchmark -t set,get,incr -n 1000000 -q
```

- é€šè¿‡ `-t` å‚æ•°ï¼Œè®¾ç½®ä»…ä»…æµ‹è¯• SET/GET/INCR å‘½ä»¤
- é€šè¿‡ `-n` å‚æ•°ï¼Œè®¾ç½®æ¯ä¸ªæµ‹è¯•æ‰§è¡Œ 1000000 æ¬¡æ“ä½œã€‚
- é€šè¿‡ `-q` å‚æ•°ï¼Œè®¾ç½®ç²¾ç®€è¾“å‡ºç»“æœã€‚

#### pipeline æµ‹è¯•

åœ¨ä¸€äº›ä¸šåŠ¡åœºæ™¯ï¼Œæˆ‘ä»¬å¸Œæœ›é€šè¿‡ Redis pipeline åŠŸèƒ½ï¼Œæ‰¹é‡æäº¤å‘½ä»¤ç»™ Redis Server ï¼Œä»è€Œæå‡æ€§èƒ½ã€‚é‚£ä¹ˆï¼š

```bash
redis-benchmark -t set,get,incr -n 1000000 -q -P 10
```

- é€šè¿‡ `-P` å‚æ•°ï¼Œè®¾ç½®æ¯ä¸ª pipeline æ‰§è¡Œ 10 æ¬¡ Redis å‘½ä»¤ã€‚

#### éšæœº KEY æµ‹è¯•

```bash
redis-benchmark -t set -n 1000 -q -r 10
```

- é€šè¿‡ `-r 10` å‚æ•°ï¼Œè®¾ç½® KEY çš„éšæœºèŒƒå›´ä¸º `-r 10` ã€‚

é€šè¿‡ `-r` å‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥æµ‹è¯•éšæœº KEY çš„æƒ…å†µä¸‹çš„æ€§èƒ½ã€‚



### 2.1.5é€šè¿‡wrkè¿›è¡ŒTomcatåŸºå‡†æµ‹è¯•

é¦–å…ˆåœ¨Tomcatä¸­å¯åŠ¨ä¸€ä¸ªJavaé¡¹ç›®ï¼š

```bash
java -jar lab-05-tomcat-1.0-SNAPSHOT.jar -Xms2g -Xmx2g -Xmn1g -XX:MaxMetaspaceSize=256m -Xss256k
```



#### æµ‹è¯•å®è·µ

```bash
./wrk -t50 -c400 -d30s http://127.0.0.1:8080/hello
```



## 2.2. æµ‹è¯•ç»“æœæ€»ç»“

è¯·ç”¨æ•°æ®å¯¹æµ‹è¯•è¿›è¡Œæ€»ç»“ï¼Œå¦‚æµ‹è¯•ç”¨ä¾‹çš„æ•°é‡ï¼Œé€šè¿‡ç‡ç­‰ï¼Œå¯æŒ‰å­ç³»ç»Ÿæ¥è¿›è¡Œåˆ†ç±»è¯´æ˜ã€‚

| ***\*æµ‹è¯•è½®æ¬¡\**** | ***\*ç”¨ä¾‹æ•°\**** | ***\*ç”¨ä¾‹é€šè¿‡ç‡\**** | ***\*é—®é¢˜æ•°\**** | ***\*å¤‡æ³¨\**** |
| ------------------ | ---------------- | -------------------- | ---------------- | -------------- |
| ç¬¬ä¸€è½®             | 36               | 88.9%                | 16               |                |
| ç¬¬äºŒè½®             | 38               | 94.7%                | 6                |                |
| ç¬¬ä¸‰è½®             | 39               | 100%                 | 0                |                |
|                    |                  |                      |                  |                |

 

 

 

## 2.3. ç¼ºé™·åˆ†å¸ƒæ€»ç»“

å½¢æˆç¼ºé™·çš„æ¨¡å—åˆ†å¸ƒã€ä¸¥é‡æ€§åˆ†å¸ƒã€ç´§æ€¥ç¨‹åº¦åˆ†å¸ƒç­‰å„é¡¹ç¼ºé™·åˆ†å¸ƒå…³ç³»å›¾





# 3.æ€§èƒ½æµ‹è¯•

ä»¥ä¸‹åˆ†åˆ«æè¿°æµ‹è¯•è¿‡ç¨‹ä¸­ä¸»è¦çš„å„é¡¹æ´»åŠ¨ï¼Œä»‹ç»æµ‹è¯•è¿‡ç¨‹å†…å®¹ï¼Œé‡åˆ°çš„é—®é¢˜ï¼Œä»¥åŠå…¶å®ƒå‘ç”Ÿçš„ä¸»è¦äº‹ä»¶ã€‚**ä¸‹é¢çš„æ•°æ®ç»Ÿè®¡æœ€å¥½ä»¥è¡¨æ ¼ï¼Œæˆ–æ¡å½¢å›¾ã€é¥¼çŠ¶å›¾çš„å½¢å¼å±•ç°**

## 3.1. æµ‹è¯•è¿‡ç¨‹

### 3.1.1é€šè¿‡jmeterè¿›è¡Œæ•°æ®åº“æ€§èƒ½å‹æµ‹

éœ€è¦å¯¹æ•°æ®åº“å‘èµ·è¯·æ±‚æˆ–è€…å¯¹æ•°æ®åº“æ–½åŠ å‹åŠ›ï¼Œé‚£ä¹ˆè¿™æ—¶å€™å°±éœ€è¦ç”¨åˆ°**JDBC Request**ã€‚

JDBC Requestå¯ä»¥å‘æ•°æ®åº“å‘é€ä¸€ä¸ªè¯·æ±‚ï¼ˆsqlè¯­å¥ï¼‰ï¼Œä¸€èˆ¬å®ƒéœ€è¦é…åˆJDBC Connection Configurationé…ç½®å…ƒä»¶ä¸€èµ·ä½¿ç”¨

é¦–å…ˆï¼Œè¿˜æ˜¯å…ˆå»ºç«‹ä¸€ä¸ªæµ‹è¯•è®¡åˆ’ï¼Œæ·»åŠ çº¿ç¨‹ç»„ã€‚

![img](https://images2015.cnblogs.com/blog/983980/201610/983980-20161012152908796-540030749.png)

ä¸ºäº†æ–¹ä¾¿ï¼Œè¿™é‡Œçº¿ç¨‹æ•°æˆ‘è®¾ç½®ä¸º1ï¼Œç„¶ååœ¨çº¿ç¨‹ç»„ä¸Šé¢å³é”®å•å‡»é€‰æ‹©é…ç½®å…ƒä»¶â†’ **JDBC Connection Configurationï¼ˆJDBCè¿æ¥é…ç½®ï¼‰**

![img](https://images2015.cnblogs.com/blog/983980/201610/983980-20161012155343906-806209958.png)

 

JDBC Connection Configurationç•Œé¢å¦‚ä¸‹ï¼š

![img](https://images2015.cnblogs.com/blog/983980/201610/983980-20161012161853687-1752227876.png)

**Variable Nameï¼ˆå˜é‡åï¼‰ï¼š**è¿™é‡Œå†™å…¥æ•°æ®åº“è¿æ¥æ± çš„åå­—

**Database URLï¼š**æ•°æ®åº“è¿æ¥åœ°å€

**JDBC Driver classï¼š**æ•°æ®åº“é©±åŠ¨ï¼ˆå¯ä»¥å°†éœ€è¦è¿æ¥çš„æ•°æ®åº“é©±åŠ¨jaråŒ…å¤åˆ¶åˆ°jmeterçš„lib/ç›®å½•ä¸‹ï¼Œç„¶ååœ¨è®¾ç½®æµ‹è¯•è®¡åˆ’ç•Œé¢ï¼Œæœ€ä¸‹é¢çš„Libraryä¸­å¯¼å…¥ï¼‰

![img](https://images2015.cnblogs.com/blog/983980/201610/983980-20161012162444750-1317114640.png)

**Usernameï¼š**æ•°æ®åº“ç™»å½•å

**Passwordï¼š**æ•°æ®åº“ç™»é™†å¯†ç 

è¿™é‡Œé¡ºå¸¦è¯´è¯´ä¸åŒæ•°æ®åº“çš„é©±åŠ¨ç±»å’ŒURLæ ¼å¼ï¼š

![img](https://images2015.cnblogs.com/blog/983980/201610/983980-20161012163845984-1752650747.png)

 

è®¾ç½®å¥½JDBCè¿æ¥é…ç½®åï¼Œæ·»åŠ JDBCè¯·æ±‚ï¼Œç•Œé¢å¦‚ä¸‹ï¼š

![img](https://images2015.cnblogs.com/blog/983980/201610/983980-20161012164257625-1606549546.png)

**Variable nameï¼š**è¿™é‡Œå†™å…¥æ•°æ®åº“è¿æ¥æ± çš„åå­—ï¼ˆå’ŒJDBC Connection Configurationåå­—ä¿æŒä¸€è‡´ ï¼‰

**Queryï¼š**é‡Œé¢å¡«å…¥æŸ¥è¯¢æ•°æ®åº“æ•°æ®çš„SQLè¯­å¥ï¼ˆå¡«å†™çš„SQLè¯­å¥æœ«å°¾ä¸è¦åŠ â€œï¼›â€ï¼‰

**parameter valusï¼š**æ•°æ®çš„å‚æ•°å€¼

**parameter typesï¼š**æ•°æ®çš„å‚æ•°ç±»å‹

**cariable namesï¼š**ä¿å­˜SQLè¯­å¥è¿”å›ç»“æœçš„å˜é‡å

**result cariable nameï¼š**åˆ›å»ºä¸€ä¸ªå¯¹è±¡å˜é‡ï¼Œä¿å­˜æ‰€æœ‰è¿”å›ç»“æœ

**query timeoutï¼š**æŸ¥è¯¢è¶…æ—¶æ—¶é—´

**handle result setï¼š**å®šä¹‰å¦‚ä½•å¤„ç†ç”±callable statementsè¯­å¥è¿”å›çš„ç»“æœ

 

å®Œæˆäº†ä¸Šé¢çš„æ“ä½œåï¼Œå°±å¯ä»¥æ·»åŠ ç›‘å¬å™¨ï¼Œæ¥æŸ¥çœ‹æˆ‘ä»¬çš„è¯·æ±‚æ˜¯å¦æˆåŠŸäº†

![img](https://images2015.cnblogs.com/blog/983980/201610/983980-20161012170644140-12896310.png)

è¿™æ˜¯è¯·æ±‚å†…å®¹ï¼Œå³SQLè¯­å¥

![img](https://images2015.cnblogs.com/blog/983980/201610/983980-20161012170704250-559440878.png)

è¿™æ˜¯å“åº”æ•°æ®ï¼Œæ­£ç¡®çš„æ˜¾ç¤ºäº†æˆ‘æŸ¥è¯¢çš„è¯¥è¡¨çš„å¯¹åº”å­—æ®µçš„æ•°æ®

###  3.1.2é€šè¿‡Jmeterå¯¹HTTPè¯·æ±‚è¿›è¡Œæ€§èƒ½å‹æµ‹

- æ­¥éª¤1: åœ¨æµ‹è¯•è®¡åˆ’ä¸‹æ·»åŠ ä¸€ä¸ªçº¿ç¨‹ç»„ï¼Œé€‰æ‹©èœå•ä¿¡æ¯å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š
  ![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/20190925093509480.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9saXVtaWFvY24uYmxvZy5jc2RuLm5ldA==,size_16,color_FFFFFF,t_70)
- æ­¥éª¤2: åœ¨åˆšåˆšåˆ›å»ºçš„çº¿ç¨‹ç»„ä¸Šæ·»åŠ ä¸€ä¸ªHTTPè¯·æ±‚çš„å–æ ·å™¨ï¼Œé€‰æ‹©èœå•ä¿¡æ¯å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š
  ![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/20190928171348459.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9saXVtaWFvY24uYmxvZy5jc2RuLm5ldA==,size_16,color_FFFFFF,t_70)
- æ­¥éª¤3: æ·»åŠ ä¸€ä¸ªèšåˆæŠ¥å‘Šï¼Œé€‰æ‹©èœå•ä¿¡æ¯å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š
  ![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/2019092817145343.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9saXVtaWFvY24uYmxvZy5jc2RuLm5ldA==,size_16,color_FFFFFF,t_70)
- æ­¥éª¤4: ä¿å­˜æµ‹è¯•è®¡åˆ’
  ç‚¹å‡»ä¿å­˜æµ‹è¯•è®¡åˆ’æŒ‰é’®å°†ç»“æœä¿å­˜ä¸º/tmp/nginx-test.jmx
- æ­¥éª¤5: åœ¨èšåˆæŠ¥å‘Šé¡µé¢è®¾å®šjtlæ–‡ä»¶
  åœ¨èšåˆæŠ¥å‘Šé¡µé¢è®¾å®šå†™å…¥å’Œjtlæ–‡ä»¶è·¯å¾„ä¸ºï¼š/tmp/nginx-test.jtl
  ![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/20190928174436514.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9saXVtaWFvY24uYmxvZy5jc2RuLm5ldA==,size_16,color_FFFFFF,t_70)

#### HTTPæµ‹è¯•

> è¿›è¡Œä¸€æ¬¡HTTP GETçš„æˆåŠŸæµ‹è¯•ï¼Œé€šè¿‡JMeterçš„HTTPå–æ ·å™¨æ‰§è¡Œä¸€æ¬¡GET http://localhost:8088/

##### æµ‹è¯•è®¾å®š

HTTPè¯·æ±‚è®¾å®šå¦‚ä¸‹ä¿¡æ¯ï¼Œå»ºç«‹ä¸nginxæœåŠ¡ä¹‹é—´çš„å…³è”ï¼Œåœ¨æœ¬ä¾‹ä¸­è®¾å®šå†…å®¹å¦‚ä¸‹æ‰€ç¤º

| è®¾å®šé¡¹           | è®¾å®šå†…å®¹  |
| ---------------- | --------- |
| åè®®             | http      |
| æœåŠ¡å™¨åç§°æˆ–è€…ip | localhost |
| ç«¯å£å·           | 8088      |
| HTTè¯·æ±‚/æ–¹æ³•     | GET       |
| HTTPè¯·æ±‚/è·¯å¾„    | /         |

è¯¦ç»†è®¾å®šå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/20190928172115528.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9saXVtaWFvY24uYmxvZy5jc2RuLm5ldA==,size_16,color_FFFFFF,t_70)

#### çº¿ç¨‹ç»„è®¾å®š

ä¿æŒçº¿ç¨‹ç»„ä¿¡æ¯ä¸ºç¼ºçœè®¾å®šå³å¯ï¼Œè®¾å®šå†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š

| è®¾å®šé¡¹   | è®¾å®šå€¼ |
| -------- | ------ |
| çº¿ç¨‹æ•°   | 1      |
| å¾ªç¯æ¬¡æ•° | 1      |

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/20190928173326589.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9saXVtaWFvY24uYmxvZy5jc2RuLm5ldA==,size_16,color_FFFFFF,t_70)

#### æ‰§è¡Œ&èšåˆæŠ¥å‘Š

ç‚¹å‡»ç»¿è‰²çš„å¯åŠ¨æŒ‰é’®å¼€å§‹æ‰§è¡Œï¼Œç„¶åç‚¹å‡»èšåˆæŠ¥å‘Šå¯ä»¥çœ‹èšåˆæŠ¥å‘Šå¦‚ä¸‹æ‰€ç¤ºï¼š
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/20190928174617675.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9saXVtaWFvY24uYmxvZy5jc2RuLm5ldA==,size_16,color_FFFFFF,t_70)
ä»nginx-test.jtlæ–‡ä»¶ä¸­ä¹Ÿå¯ä»¥çœ‹åˆ°ç»“æœçš„è¯¦ç»†ä¿¡æ¯ï¼Œå¯ä»¥çœ‹åˆ°è¿”å›çš„ç»“æœ200ç ï¼Œä»¥åŠsuccesså­—æ®µçš„trueçš„ç»“æœä¿¡æ¯ï¼Œè¯´æ˜è¿™æ˜¯ä¸€æ¬¡æˆåŠŸçš„æ‰§è¡Œï¼Œå¦å¤–åœ¨èšåˆæŠ¥å‘Šä¸­çš„å¼‚å¸¸%çš„ç»“æœæ˜¯0ä¹Ÿå¯ä»¥çœ‹å‡ºè¿™ä¸€ç‚¹ã€‚

```
liumiaocn:tmp liumiao$ cat nginx-test.jtl
timeStamp,elapsed,label,responseCode,responseMessage,threadName,dataType,success,failureMessage,bytes,sentBytes,grpThreads,allThreads,URL,Latency,IdleTime,Connect
1569663931702,5,HTTPè¯·æ±‚,200,OK,çº¿ç¨‹ç»„ 1-1,text,true,,850,118,1,1,http://localhost:8088/,5,0,3
liumiaocn:tmp liumiao$
1234
```

æ¥ä¸‹æ¥æ•…æ„ä¿®æ”¹ä¸€ä¸‹HTTPè¯·æ±‚çš„ç«¯å£å·ï¼Œæ”¹æˆé”™è¯¯çš„æœ¬åœ°æ²¡æœ‰HTTPæœåŠ¡çš„ç«¯å£å·ï¼Œæ¯”å¦‚8089ï¼Œè®¾å®šç¤ºä¾‹å¦‚ä¸‹æ‰€ç¤ºï¼š
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/20190928175305805.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9saXVtaWFvY24uYmxvZy5jc2RuLm5ldA==,size_16,color_FFFFFF,t_70)
ç‚¹å‡»ç»¿è‰²çš„å¯åŠ¨æŒ‰é’®å¼€å§‹æ‰§è¡Œï¼Œä¼šæç¤ºä¸€ä¸ªWarningï¼Œå› ä¸ºåœ¨æµ‹è¯•ä¸­ä¿®æ”¹è®¾å®šï¼Œæ˜¯å¦è¿˜æ˜¯ä¸€ä¸ªå‹åŠ›æµ‹è¯•æ˜¯éœ€è¦ä½¿ç”¨è€…è‡ªå·±åˆ¤æ–­çš„ï¼Œè¿™é‡Œä¸ºäº†æ¼”ç¤ºé€‰æ‹©â€œæ·»åŠ åˆ°ç°æœ‰æ–‡ä»¶â€
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/20190928175533695.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9saXVtaWFvY24uYmxvZy5jc2RuLm5ldA==,size_16,color_FFFFFF,t_70)
ç„¶åç‚¹å‡»èšåˆæŠ¥å‘Šå¯ä»¥çœ‹èšåˆæŠ¥å‘Šå¦‚ä¸‹æ‰€ç¤ºï¼š
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/20190928175627633.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9saXVtaWFvY24uYmxvZy5jc2RuLm5ldA==,size_16,color_FFFFFF,t_70)
ä»nginx-test.jtlæ–‡ä»¶ä¸­ä¹Ÿå¯ä»¥çœ‹åˆ°ç»“æœçš„è¯¦ç»†ä¿¡æ¯ï¼ŒConnection refusedçš„é”™è¯¯ä¿¡æ¯ï¼Œä»¥åŠsuccesså­—æ®µçš„falseçš„ç»“æœä¿¡æ¯ï¼Œè¯´æ˜è¿™æ˜¯ä¸€æ¬¡å¤±è´¥çš„æ‰§è¡Œï¼Œå¦å¤–åœ¨èšåˆæŠ¥å‘Šä¸­çš„å¼‚å¸¸%çš„ç»“æœä¹Ÿå˜æˆäº†50%ï¼ˆå…±è®¡ä¸¤æ¬¡å–æ ·æµ‹è¯•ï¼Œä¸Šä¸€æ¬¡æ‰§è¡Œçš„ç»“æœæˆåŠŸï¼Œæ‰€ä»¥å¼‚å¸¸ä¸º50%ï¼‰ä¹Ÿå¯ä»¥çœ‹å‡ºè¿™ä¸€ç‚¹ã€‚

```
liumiaocn:tmp liumiao$ cat nginx-test.jtl
timeStamp,elapsed,label,responseCode,responseMessage,threadName,dataType,success,failureMessage,bytes,sentBytes,grpThreads,allThreads,URL,Latency,IdleTime,Connect
1569663931702,5,HTTPè¯·æ±‚,200,OK,çº¿ç¨‹ç»„ 1-1,text,true,,850,118,1,1,http://localhost:8088/,5,0,3
1569664469242,2,HTTPè¯·æ±‚,Non HTTP response code: org.apache.http.conn.HttpHostConnectException,"Non HTTP response message: Connect to localhost:8089 [localhost/127.0.0.1, localhost/0:0:0:0:0:0:0:1] failed: Connection refused (Connection refused)",çº¿ç¨‹ç»„ 1-1,text,false,,2673,0,1,1,http://localhost:8089/,0,0,2
liumiaocn:tmp liumiao$ 
12345
```

#### æµ‹è¯•æŠ¥å‘Š

- ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š

> æ‰§è¡Œå‘½ä»¤ï¼šbin/jmeter -g /tmp/nginx-test.jtl -e -o /tmp/nginx-test-rpt-1 -j /tmp/nginx-rpt.log

- æµ‹è¯•æŠ¥å‘Šçš„æ¦‚è¦ä¿¡æ¯å¦‚ä¸‹æ‰€ç¤ºï¼š
  ![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/2019092818150985.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9saXVtaWFvY24uYmxvZy5jc2RuLm5ldA==,size_16,color_FFFFFF,t_70)

> é‡æ–°å°†ç«¯å£å·ä¿®æ­£ä¸º8080ï¼Œä¿è¯HTTPæµ‹è¯•èƒ½æ­£ç¡®æ‰§è¡Œçš„åŸºç¡€ä¹‹ä¸Šï¼Œè¿›è¡Œå¦‚ä¸‹å‹åŠ›æµ‹è¯•ï¼šå¹¶å‘ç”¨æˆ·æ•°100ã€å¾ªç¯360æ¬¡ã€æŒç»­æ—¶é—´180ç§’çš„å†…ç½®HTTPè¯·æ±‚éªŒè¯

è®¾å®šä¿¡æ¯å¦‚ä¸‹ï¼š

| è®¾å®šé¡¹   | è®¾å®šå€¼ |
| -------- | ------ |
| çº¿ç¨‹æ•°   | 100    |
| å¾ªç¯æ¬¡æ•° | 360    |
| æŒç»­æ—¶é—´ | 180s   |

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/2019092509590387.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9saXVtaWFvY24uYmxvZy5jc2RuLm5ldA==,size_16,color_FFFFFF,t_70)

ç‚¹å‡»ç»¿è‰²çš„å¯åŠ¨æŒ‰é’®å¼€å§‹æ‰§è¡Œï¼Œä¼šæç¤ºä¸€ä¸ªWarningï¼Œè¿™é‡Œä¸ºäº†æ¼”ç¤ºä»ç„¶é€‰æ‹©â€œæ·»åŠ åˆ°ç°æœ‰æ–‡ä»¶â€
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/20190928175533695.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9saXVtaWFvY24uYmxvZy5jc2RuLm5ldA==,size_16,color_FFFFFF,t_70)
ç„¶åç‚¹å‡»èšåˆæŠ¥å‘Šå¯ä»¥çœ‹èšåˆæŠ¥å‘Šå¦‚ä¸‹æ‰€ç¤ºï¼š
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/20190928182206834.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9saXVtaWFvY24uYmxvZy5jc2RuLm5ldA==,size_16,color_FFFFFF,t_70)
å¯ä»¥çœ‹åˆ°æ ·æœ¬æ•°é‡ä¸º36002ï¼Œå› ä¸º100çº¿ç¨‹ç»„*360æ¬¡å¾ªç¯ + æ—¢å­˜çš„ä¸¤æ¬¡æµ‹è¯•ç»“æœï¼Œæ‰€ä»¥æ€»è®¡36002æ¬¡å‹åŠ›æµ‹è¯•æ ·æœ¬ï¼Œç›¸è¾ƒäºå‰æ–‡ä¸­ä½¿ç”¨å†…ç½®çš„Javaè¯·æ±‚ï¼Œä½¿ç”¨ç¼ºçœçš„nginxè®¾å®šçš„æƒ…å†µä¸‹ï¼Œå¼‚å¸¸ç‡å·²ç»ä¸Šå‡è‡³9.17%äº†ã€‚

#### æµ‹è¯•æŠ¥å‘Š

- ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š

> æ‰§è¡Œå‘½ä»¤ï¼šbin/jmeter -g /tmp/nginx-test.jtl -e -o /tmp/nginx-test-rpt-2 -j /tmp/nginx-rpt.log

- æµ‹è¯•æŠ¥å‘Šçš„æ¦‚è¦ä¿¡æ¯å¦‚ä¸‹æ‰€ç¤ºï¼š
  ![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/20190928182653750.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9saXVtaWFvY24uYmxvZy5jc2RuLm5ldA==,size_16,color_FFFFFF,t_70)



## 3.2. æµ‹è¯•ç»“æœæ€»ç»“

è¯·ç”¨æ•°æ®å¯¹æµ‹è¯•è¿›è¡Œæ€»ç»“ï¼Œå¦‚æµ‹è¯•ç”¨ä¾‹çš„æ•°é‡ï¼Œé€šè¿‡ç‡ç­‰ï¼Œå¯æŒ‰å­ç³»ç»Ÿæ¥è¿›è¡Œåˆ†ç±»è¯´æ˜ã€‚

| ***\*æµ‹è¯•è½®æ¬¡\**** | ***\*ç”¨ä¾‹æ•°\**** | ***\*ç”¨ä¾‹é€šè¿‡ç‡\**** | ***\*é—®é¢˜æ•°\**** | ***\*å¤‡æ³¨\**** |
| ------------------ | ---------------- | -------------------- | ---------------- | -------------- |
| ç¬¬ä¸€è½®             | 36               | 88.9%                | 16               |                |
| ç¬¬äºŒè½®             | 38               | 94.7%                | 6                |                |
| ç¬¬ä¸‰è½®             | 39               | 100%                 | 0                |                |
|                    |                  |                      |                  |                |

 

 

 

## 3.3. ç¼ºé™·åˆ†å¸ƒæ€»ç»“

å½¢æˆç¼ºé™·çš„æ¨¡å—åˆ†å¸ƒã€ä¸¥é‡æ€§åˆ†å¸ƒã€ç´§æ€¥ç¨‹åº¦åˆ†å¸ƒç­‰å„é¡¹ç¼ºé™·åˆ†å¸ƒå…³ç³»å›¾



# 4.å®‰å…¨æµ‹è¯•

ä»¥ä¸‹åˆ†åˆ«æè¿°æµ‹è¯•è¿‡ç¨‹ä¸­ä¸»è¦çš„å„é¡¹æ´»åŠ¨ï¼Œä»‹ç»æµ‹è¯•è¿‡ç¨‹å†…å®¹ï¼Œé‡åˆ°çš„é—®é¢˜ï¼Œä»¥åŠå…¶å®ƒå‘ç”Ÿçš„ä¸»è¦äº‹ä»¶ã€‚**ä¸‹é¢çš„æ•°æ®ç»Ÿè®¡æœ€å¥½ä»¥è¡¨æ ¼ï¼Œæˆ–æ¡å½¢å›¾ã€é¥¼çŠ¶å›¾çš„å½¢å¼å±•ç°**

## 4.1. æµ‹è¯•è¿‡ç¨‹



 

## 4.2. æµ‹è¯•ç»“æœ



 

## 4.3. ç¼ºé™·åˆ†å¸ƒ

å½¢æˆç¼ºé™·çš„æ¨¡å—åˆ†å¸ƒã€ä¸¥é‡æ€§åˆ†å¸ƒã€ç´§æ€¥ç¨‹åº¦åˆ†å¸ƒç­‰å„é¡¹ç¼ºé™·åˆ†å¸ƒå…³ç³»å›¾



# 5.æ¸—é€æµ‹è¯•

ä»¥ä¸‹åˆ†åˆ«æè¿°æµ‹è¯•è¿‡ç¨‹ä¸­ä¸»è¦çš„å„é¡¹æ´»åŠ¨ï¼Œä»‹ç»æµ‹è¯•è¿‡ç¨‹å†…å®¹ï¼Œé‡åˆ°çš„é—®é¢˜ï¼Œä»¥åŠå…¶å®ƒå‘ç”Ÿçš„ä¸»è¦äº‹ä»¶ã€‚**ä¸‹é¢çš„æ•°æ®ç»Ÿè®¡æœ€å¥½ä»¥è¡¨æ ¼ï¼Œæˆ–æ¡å½¢å›¾ã€é¥¼çŠ¶å›¾çš„å½¢å¼å±•ç°**

## 5.1. æµ‹è¯•è¿‡ç¨‹æ€»ç»“



 

## 5.2. æµ‹è¯•ç»“æœæ€»ç»“

 

 

## 5.3. ç¼ºé™·åˆ†å¸ƒæ€»ç»“

å½¢æˆç¼ºé™·çš„æ¨¡å—åˆ†å¸ƒã€ä¸¥é‡æ€§åˆ†å¸ƒã€ç´§æ€¥ç¨‹åº¦åˆ†å¸ƒç­‰å„é¡¹ç¼ºé™·åˆ†å¸ƒå…³ç³»å›¾



# 6.æµ‹è¯•åå·®

æè¿°æµ‹è¯•ä¸­å‘ç°çš„ã€æ²¡æœ‰æ»¡è¶³éœ€æ±‚æˆ–å…¶å®ƒæ–¹é¢è¦æ±‚çš„éƒ¨åˆ†ï¼Œå¹¶ç»™å‡ºè¯¦ç»†çš„è§£é‡ŠåŠå»ºè®®çš„è§£å†³æ–¹æ¡ˆã€‚

 

# **7.** å…¶ä»–è¯´æ˜

æè¿°æ²¡æœ‰åœ¨ä»¥ä¸Šå„éƒ¨åˆ†æ¶µç›–çš„å¹¶ä¸”éœ€è¦è¯´æ˜çš„å†…å®¹ï¼Œå¦‚è®¡åˆ’å’Œæµ‹è¯•ç”¨ä¾‹ä¸­çš„æ‰€æœ‰å˜æ›´ï¼Œä»¥åŠæ¯ä¸ªå˜æ›´çš„åŸå› ç­‰ã€‚

 

# **8.**ç»¼åˆè¯„ä»·

é’ˆå¯¹æœ¬é¡¹ç›®çš„æµ‹è¯•è¯´æ˜å„ä¸ªéƒ¨åˆ†çš„æµ‹è¯•ç»“æœï¼Œå¹¶ç»™å‡ºè¯„ä»·ã€‚

â€‹	æä¾›æµ‹è¯•çš„å…¨é¢è¯„ä»·ï¼ŒåŒ…æ‹¬å®ƒçš„å±€é™æ€§ï¼Œæ˜¯å¦å»ºè®®é€šè¿‡ç­‰ã€‚

æœ¬è¯„ä»·å¿…é¡»å»ºç«‹åœ¨æµ‹è¯•ç»“æœå’Œé€šè¿‡/ä¸é€šè¿‡æ ‡å‡†çš„åŸºç¡€ä¸Šï¼Œå¹¶ä¸”å¯¹å…¶è¯„ä»·ç»“æœçš„å¯é æ€§è¿›è¡Œä¼°è®¡ï¼Œå¦‚å»ºè®®é€šè¿‡æµ‹è¯•æ—¶ï¼Œè¿˜å¯èƒ½å­˜åœ¨å“ªäº›é£é™©ã€‚

# é™„ï¼š

